<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Govind G Nair">
<meta name="dcterms.date" content="2019-03-17">
<meta name="description" content="Highlights from the 2019 R Studio Conference">

<title>R Studio Conference 2019</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-d166b450ba5a8e9f7a0ab969bf6592c1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-22381ab97ffb8a420d3841344730e94d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">R Studio Conference 2019</h1>
                  <div>
        <div class="description">
          Highlights from the 2019 R Studio Conference
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Conferences</div>
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Govind G Nair </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 17, 2019</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#reproducible-examples-with-reprex" id="toc-reproducible-examples-with-reprex" class="nav-link active" data-scroll-target="#reproducible-examples-with-reprex">Reproducible Examples with reprex</a></li>
  <li><a href="#categorical-data-in-r" id="toc-categorical-data-in-r" class="nav-link" data-scroll-target="#categorical-data-in-r">Categorical data in R</a></li>
  <li><a href="#defensive-coding" id="toc-defensive-coding" class="nav-link" data-scroll-target="#defensive-coding">Defensive Coding</a></li>
  <li><a href="#new-features-in-r-studio-1.2" id="toc-new-features-in-r-studio-1.2" class="nav-link" data-scroll-target="#new-features-in-r-studio-1.2">New Features in R Studio 1.2</a>
  <ul class="collapse">
  <li><a href="#python" id="toc-python" class="nav-link" data-scroll-target="#python">Python</a></li>
  </ul></li>
  <li><a href="#parsnip---a-tidy-model-interface" id="toc-parsnip---a-tidy-model-interface" class="nav-link" data-scroll-target="#parsnip---a-tidy-model-interface">Parsnip - A tidy model interface</a></li>
  <li><a href="#time-series-in-tidyverse" id="toc-time-series-in-tidyverse" class="nav-link" data-scroll-target="#time-series-in-tidyverse">Time Series in Tidyverse</a></li>
  <li><a href="#model-representation-using-broom" id="toc-model-representation-using-broom" class="nav-link" data-scroll-target="#model-representation-using-broom">Model representation using Broom</a></li>
  <li><a href="#gganimate" id="toc-gganimate" class="nav-link" data-scroll-target="#gganimate">gganimate</a></li>
  <li><a href="#hypothetical-outcome-plots" id="toc-hypothetical-outcome-plots" class="nav-link" data-scroll-target="#hypothetical-outcome-plots">Hypothetical Outcome Plots</a></li>
  <li><a href="#datapasta" id="toc-datapasta" class="nav-link" data-scroll-target="#datapasta">Datapasta</a></li>
  <li><a href="#vctrs" id="toc-vctrs" class="nav-link" data-scroll-target="#vctrs">vctrs</a></li>
  <li><a href="#tidy-evaluation" id="toc-tidy-evaluation" class="nav-link" data-scroll-target="#tidy-evaluation">Tidy Evaluation</a>
  <ul class="collapse">
  <li><a href="#action-and-selection-verbs" id="toc-action-and-selection-verbs" class="nav-link" data-scroll-target="#action-and-selection-verbs">Action and Selection Verbs</a></li>
  </ul></li>
  <li><a href="#profviz" id="toc-profviz" class="nav-link" data-scroll-target="#profviz">profviz</a></li>
  <li><a href="#using-spark-to-scale-out-your-jobs" id="toc-using-spark-to-scale-out-your-jobs" class="nav-link" data-scroll-target="#using-spark-to-scale-out-your-jobs">Using Spark to scale out your jobs</a></li>
  <li><a href="#shiny" id="toc-shiny" class="nav-link" data-scroll-target="#shiny">Shiny</a></li>
  <li><a href="#miscellaneous" id="toc-miscellaneous" class="nav-link" data-scroll-target="#miscellaneous">Miscellaneous</a>
  <ul class="collapse">
  <li><a href="#sunburst-charts" id="toc-sunburst-charts" class="nav-link" data-scroll-target="#sunburst-charts">Sunburst Charts</a></li>
  <li><a href="#rayshader" id="toc-rayshader" class="nav-link" data-scroll-target="#rayshader">rayshader</a></li>
  </ul></li>
  <li><a href="#other-usefulinteresting-resources" id="toc-other-usefulinteresting-resources" class="nav-link" data-scroll-target="#other-usefulinteresting-resources">Other useful/interesting resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>This is a notebook summarizing what I learned at the R Studio Conference 2019 Links to all the talks and slide decks,including talks on how to use R in production at scale are available at <a href="https://github.com/kbroman/RStudioConf2019Slides" class="uri">https://github.com/kbroman/RStudioConf2019Slides</a></p>
<p>Make sure the libraries being used in each section are installed.</p>
<section id="reproducible-examples-with-reprex" class="level2">
<h2 class="anchored" data-anchor-id="reproducible-examples-with-reprex">Reproducible Examples with reprex</h2>
<p>The reprex package allows you to create a minimal reproducible example that you can share if you are reporting an issue on Github or asking a question on stack overflow. Running the code chunk below after uncommenting will create a new web page with the code and the results that can be shared with others.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reprex({</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   x &lt;- 1:4</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   y &lt;- 2:5</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   x + y</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># })</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="categorical-data-in-r" class="level2">
<h2 class="anchored" data-anchor-id="categorical-data-in-r">Categorical data in R</h2>
<p>Factor variables in R can be idiosyncratic</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">20</span>,<span class="dv">10</span>,<span class="dv">40</span>,<span class="dv">20</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 20 20 10 40 20</code></pre>
<p>Converting this to a factor variable produces the following</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>xf <span class="ot">&lt;-</span> <span class="fu">factor</span>(x)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>xf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 20 20 10 40 20
## Levels: 10 20 40</code></pre>
<p>Converting this factor back to numeric produces the following odd result</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(xf)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 2 2 1 3 2</code></pre>
<p>The right way to carry out this conversion is as follows</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(xf))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 20 20 10 40 20</code></pre>
<p>One also needs to be careful while re-ordering the levels of a factor</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ratings1<span class="ot">&lt;-</span>  <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">'High'</span>,<span class="dv">30</span>),<span class="fu">rep</span>(<span class="st">'Low'</span>,<span class="dv">10</span>),<span class="fu">rep</span>(<span class="st">'Medium'</span>,<span class="dv">20</span>)))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>ratings2 <span class="ot">&lt;-</span> ratings1</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>ratings3 <span class="ot">&lt;-</span> ratings1</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ratings1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## ratings1
##   High    Low Medium 
##     30     10     20</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'Levels: </span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## Levels:</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">levels</span>(ratings1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## High Low Medium</code></pre>
<p>We might want to change the levels of this variable to be Low,Medium,High</p>
<p>The next couple of approaches do not yield expected results.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(ratings1) <span class="ot">&lt;-</span> <span class="fu">levels</span>(ratings1)[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>)]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ratings1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## ratings1
##    Low   High Medium 
##     30     10     20</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(ratings2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Low'</span>,<span class="st">'Medium'</span>,<span class="st">'High'</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ratings2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## ratings2
##    Low Medium   High 
##     30     10     20</code></pre>
<p>The correct approach here would be as follows</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ratings3 <span class="ot">&lt;-</span> <span class="fu">factor</span>(ratings3,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">'Low'</span>,<span class="st">'Medium'</span>,<span class="st">'High'</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ratings3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## ratings3
##    Low Medium   High 
##     10     20     30</code></pre>
<p>The <strong>forcats</strong> package by Hadley Wickham makes working with factors much more straightforward.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>ratings1<span class="ot">&lt;-</span>  <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">'High'</span>,<span class="dv">30</span>),<span class="fu">rep</span>(<span class="st">'Low'</span>,<span class="dv">10</span>),<span class="fu">rep</span>(<span class="st">'Medium'</span>,<span class="dv">20</span>)))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>ratings1 <span class="ot">&lt;-</span> <span class="fu">fct_relevel</span>(ratings1,<span class="fu">c</span>(<span class="st">'Low'</span>,<span class="st">'Medium'</span>,<span class="st">'High'</span>))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ratings1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## ratings1
##    Low Medium   High 
##     10     20     30</code></pre>
<p>Recoding the levels of the factors are also straightforward.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ratings1 <span class="ot">&lt;-</span> <span class="fu">fct_recode</span>(ratings1,<span class="at">Poor=</span><span class="st">'Low'</span>,<span class="at">Fair =</span><span class="st">'Medium'</span>,<span class="at">Good =</span> <span class="st">'High'</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ratings1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## ratings1
## Poor Fair Good 
##   10   20   30</code></pre>
<p>Plenty of other useful functions are available in the forcats package.</p>
</section>
<section id="defensive-coding" class="level2">
<h2 class="anchored" data-anchor-id="defensive-coding">Defensive Coding</h2>
<p>The <strong>testthat</strong> and <strong>assertthat</strong> packages allows us to code defensively. This is typically best practice in software engineering and makes debugging much easier.</p>
<p>For instance if a function is designed to accept a scalar (i.e.&nbsp;a vector of length 1), you may want the function to throw an error if a vector is passed into the function, so that you can adjust the function appropriately.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(assertthat)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>is_odd <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assert_that</span>(<span class="fu">is.numeric</span>(x), <span class="fu">length</span>(x) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">is_odd</span>(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">is_odd</span>(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#is_odd(c(1,4)) ##Throws an error##</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The see_if function returns a logical value and an error message as an attribute that allows execution to continue.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="st">'a'</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">see_if</span>(<span class="fu">is.numeric</span>(x), <span class="fu">length</span>(x) <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] FALSE
## attr(,"msg")
## [1] "length(x) not equal to 1"</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">see_if</span>(<span class="fu">is.numeric</span>(y), <span class="fu">length</span>(y) <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] FALSE
## attr(,"msg")
## [1] "y is not a numeric or integer vector"</code></pre>
<p>The testthat package provides functionality that is essential to software testing. This is useful if you are building packages or writing code that is meant to be used in production</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Check for equality within numerical tolerance</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_that</span>(<span class="dv">10</span>,<span class="fu">equals</span>(<span class="dv">10</span><span class="fl">+1e-7</span>))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="do">###Check for exact equality - Throws an error</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#expect_that(2*5, is_identical_to(10 + 1e-7))</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg<span class="sc">~</span>wt,<span class="at">data=</span>mtcars)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_that</span>(model,<span class="fu">is_a</span>(<span class="st">"lm"</span>))</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="do">###Throws an error</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#expect_that(model,is_a("glm"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you are making a function you can use this to ensure that it produces warnings when expected.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Two functions below pass</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_that</span>(<span class="fu">log</span>(<span class="sc">-</span><span class="dv">1</span>), <span class="fu">gives_warning</span>())</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_that</span>(<span class="fu">log</span>(<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">gives_warning</span>(<span class="st">"NaNs produced"</span>))</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># This one fails if run</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#expect_that(log(0), gives_warning())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="new-features-in-r-studio-1.2" class="level2">
<h2 class="anchored" data-anchor-id="new-features-in-r-studio-1.2">New Features in R Studio 1.2</h2>
<p>R Studio 1.2 allows incorporation of SQL, Python , RCPP, Stan etc seamlessly into your workflow. The reticulate package allows you to use Python within R Studio.</p>
<section id="python" class="level3">
<h3 class="anchored" data-anchor-id="python">Python</h3>
<p>Note the bit below requires R Studio 1.2 and python’s Anaconda installation. Also you might encounter the issue described <a href="https://stackoverflow.com/questions/50085788/qt-platform-plugin-issue-rstudio">here</a> and will have to fix by adding the appropriate path to the environment variable</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">use_condaenv</span>(<span class="st">"r-reticulate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'QT_QPA_PLATFORM_PLUGIN_PATH'</span>] <span class="op">=</span> <span class="st">'C:/Users/learningmachine/AppData/Local/Continuum/anaconda3/Library/plugins/platforms'</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="fl">0.0</span>,<span class="dv">2</span>,<span class="fl">0.01</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.sin(<span class="dv">2</span><span class="op">*</span> np.pi<span class="op">*</span>x)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>plt.plot(x,y)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/unnamed-chunk-18-1.png" width="672"></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame({<span class="st">'x'</span>:x,<span class="st">'y'</span>:y})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A pandas dataframe can also be used within R.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(py<span class="sc">$</span>data,<span class="fu">aes</span>(x,y))<span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">col=</span><span class="st">'blue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/unnamed-chunk-19-1.png" width="672"> SImilarly you can embed SQL or Stan code chunks in your markdown document.</p>
</section>
</section>
<section id="parsnip---a-tidy-model-interface" class="level2">
<h2 class="anchored" data-anchor-id="parsnip---a-tidy-model-interface">Parsnip - A tidy model interface</h2>
<div class="sourceCode" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parsnip)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Parsnip is tidy version of the popular caret package being developed by Max Kuhn (who also developed caret).This package creates a unified interface to models, organizes them by model type (e.g.&nbsp;Logistic regression, splines etc)and generalizes how to fit them.</p>
<p>First create a model specification</p>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = 0.01</code></pre>
<p>The computation engine can be one of <strong>lm</strong>, <strong>glmnet</strong>,<strong>stan</strong>,<strong>spark</strong> or <strong>keras</strong>. Parsnip can translate this general syntax to the model’s argument.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>reg_model <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">translate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = 0.01
## 
## Computational engine: glmnet 
## 
## Model fit template:
## glmnet::glmnet(x = missing_arg(), y = missing_arg(), weights = missing_arg(), 
##     lambda = 0.01, family = "gaussian")</code></pre>
<p>Note that data is not required for the model specification. Further although glmnet requires the predictors and target to be provided as X,y matrices , parsnip allows you to use a formula.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>reg_model <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(mpg <span class="sc">~</span> .,<span class="at">data =</span> mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## parsnip model object
## 
## 
## Call:  glmnet::glmnet(x = as.matrix(x), y = y, family = "gaussian",      lambda = ~0.01) 
## 
##      Df   %Dev Lambda
## [1,] 10 0.8687   0.01</code></pre>
<p>The whole sequence of steps from specification to prediction can be done as follows</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">linear_reg</span>(<span class="at">penalty =</span><span class="fl">0.01</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(mpg<span class="sc">~</span>.,<span class="at">dat =</span>mtcars <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">29</span>)) <span class="sc">%&gt;%</span> <span class="co"># train set</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">predict</span>(<span class="at">new_data =</span> mtcars <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">30</span><span class="sc">:</span><span class="dv">32</span>)) <span class="co">#test set</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 3 x 1
##   .pred
##   &lt;dbl&gt;
## 1  17.9
## 2  10.9
## 3  25.6</code></pre>
<p>If we want to fit the model using multiple penalty values:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fit</span>(mpg <span class="sc">~</span>. , <span class="at">data =</span> mtcars <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">29</span>))<span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">multi_predict</span>(<span class="at">new_data =</span> mtcars <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">30</span><span class="sc">:</span><span class="dv">32</span>))</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 3 x 1
##   .pred            
##   &lt;list&gt;           
## 1 &lt;tibble [80 x 2]&gt;
## 2 &lt;tibble [80 x 2]&gt;
## 3 &lt;tibble [80 x 2]&gt;</code></pre>
<p>This produces a list of dataframes where each list contains predictions for all penalty values considered. To obtain the first 5 predictions for the second data point:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>preds <span class="sc">%&gt;%</span> <span class="fu">pull</span>(.pred) <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 5 x 2
##   penalty .pred
##     &lt;dbl&gt; &lt;dbl&gt;
## 1 0.00346  10.9
## 2 0.00380  10.9
## 3 0.00417  10.9
## 4 0.00457  10.9
## 5 0.00502  10.9</code></pre>
<p>In the cases of models like random forest where certain data dependent parameters like <strong>mtry</strong> need to be specified,the model can be specified as follows:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">trees=</span> <span class="dv">1000</span>, <span class="at">mtry =</span><span class="fu">floor</span>(<span class="fu">.preds</span>() <span class="sc">*</span> <span class="fl">0.75</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">set_engine</span>(<span class="st">"randomForest"</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>mod <span class="sc">%&gt;%</span> <span class="fu">translate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## Random Forest Model Specification (unknown)
## 
## Main Arguments:
##   mtry = floor(.preds() * 0.75)
##   trees = 1000
## 
## Computational engine: randomForest 
## 
## Model fit template:
## randomForest::randomForest(x = missing_arg(), y = missing_arg(), 
##     mtry = floor(.preds() * 0.75), ntree = 1000)</code></pre>
<p>Fit the model.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>mod <span class="sc">%&gt;%</span> <span class="fu">fit</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## parsnip model object
## 
## 
## Call:
##  randomForest(x = as.data.frame(x), y = y, ntree = ~1000, mtry = ~floor(.preds() *      0.75)) 
##                Type of random forest: regression
##                      Number of trees: 1000
## No. of variables tried at each split: 7
## 
##           Mean of squared residuals: 5.352952
##                     % Var explained: 84.79</code></pre>
<p>As you can see, the number of predictors used is 75 % of the number of predictors in the data.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">floor</span>((<span class="fu">ncol</span>(mtcars) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span><span class="fl">0.75</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 7</code></pre>
</section>
<section id="time-series-in-tidyverse" class="level2">
<h2 class="anchored" data-anchor-id="time-series-in-tidyverse">Time Series in Tidyverse</h2>
<p>Tidy and Transform the data using the <strong>tsibble</strong> package and perform modelling/forecasting using <strong>fable</strong>. tsibble is a time series version of a tibble/dataframe.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsibble)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can use the EuStockMarkets data available in base R which is a ts object.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"EuStockMarkets"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>as_tibble can easily convert this into a tsibble in a long format. Here the index represents time and key identifies the variable that defines the series. Here each stock index ha a unique time stamp.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>eu_ts <span class="ot">&lt;-</span> <span class="fu">as_tsibble</span>(EuStockMarkets)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(eu_ts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tsibble: 7,440 x 3 [1s] &lt;UTC&gt;
## # Key:       key [4]
##    index               key   value
##    &lt;dttm&gt;              &lt;chr&gt; &lt;dbl&gt;
##  1 1991-07-01 02:18:28 DAX   1629.
##  2 1991-07-02 12:00:00 DAX   1614.
##  3 1991-07-03 21:41:32 DAX   1607.
##  4 1991-07-05 07:23:05 DAX   1621.
##  5 1991-07-06 17:04:37 DAX   1618.
##  6 1991-07-08 02:46:09 DAX   1611.
##  7 1991-07-09 12:27:42 DAX   1631.
##  8 1991-07-10 22:09:14 DAX   1640.
##  9 1991-07-12 07:50:46 DAX   1635.
## 10 1991-07-13 17:32:18 DAX   1646.
## # ... with 7,430 more rows</code></pre>
<p>Given the index in seconds, the tsibble expects an entry for each second, so the index should be converted to day.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>eu_ts2 <span class="ot">&lt;-</span>  eu_ts <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">as.Date</span>(index))</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(eu_ts2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tsibble: 7,440 x 3 [1s]
## # Key:       key [4]
##    index      key   value
##    &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt;
##  1 1991-07-01 DAX   1629.
##  2 1991-07-02 DAX   1614.
##  3 1991-07-03 DAX   1607.
##  4 1991-07-05 DAX   1621.
##  5 1991-07-06 DAX   1618.
##  6 1991-07-08 DAX   1611.
##  7 1991-07-09 DAX   1631.
##  8 1991-07-10 DAX   1640.
##  9 1991-07-12 DAX   1635.
## 10 1991-07-13 DAX   1646.
## # ... with 7,430 more rows</code></pre>
<p>One can also calculate the average price of a week or month as follows.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>eu_ts <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">index_by</span>(<span class="at">Month =</span> <span class="fu">floor_date</span>(index,<span class="st">'month'</span>))<span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(key)<span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarize</span>(<span class="at">Price =</span>  <span class="fu">mean</span>(value))<span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tsibble: 6 x 3 [?] &lt;UTC&gt;
## # Key:       key [1]
##   key   Month               Price
##   &lt;chr&gt; &lt;dttm&gt;              &lt;dbl&gt;
## 1 CAC   1991-07-01 00:00:00 1753.
## 2 CAC   1991-08-01 00:00:00 1800.
## 3 CAC   1991-09-01 00:00:00 1871.
## 4 CAC   1991-10-01 00:00:00 1851.
## 5 CAC   1991-11-01 00:00:00 1814.
## 6 CAC   1991-12-01 00:00:00 1693.</code></pre>
<p>We can also check if there are gaps in the time series as follows.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">has_gaps</span>(eu_ts2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 4 x 2
##   key   .gaps
##   &lt;chr&gt; &lt;lgl&gt;
## 1 CAC   TRUE 
## 2 DAX   TRUE 
## 3 FTSE  TRUE 
## 4 SMI   TRUE</code></pre>
<p>You can get a 30 day rolling average of the process as follows. Note that the first 29 observations of the rolling mean will be NA.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>eu_ts3 <span class="ot">&lt;-</span>  eu_ts2 <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">avg_30day =</span> <span class="fu">slide_dbl</span>(value,<span class="sc">~</span><span class="fu">mean</span>(.,<span class="at">na.rm =</span> <span class="cn">TRUE</span>),<span class="at">.size=</span><span class="dv">30</span>))</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(eu_ts3 <span class="sc">%&gt;%</span> <span class="fu">filter_index</span>(<span class="st">"1991-08-01"</span><span class="sc">~</span><span class="st">"1991-09-01"</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tsibble: 88 x 4 [1D]
## # Key:       key [4]
## # Groups:    key [4]
##    index      key   value avg_30day
##    &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 1991-08-02 DAX   1620.       NA 
##  2 1991-08-03 DAX   1620.       NA 
##  3 1991-08-05 DAX   1623.       NA 
##  4 1991-08-06 DAX   1614.       NA 
##  5 1991-08-08 DAX   1632.       NA 
##  6 1991-08-09 DAX   1630.       NA 
##  7 1991-08-10 DAX   1633.     1624.
##  8 1991-08-12 DAX   1627.     1624.
##  9 1991-08-13 DAX   1650.     1625.
## 10 1991-08-15 DAX   1650.     1627.
## # ... with 78 more rows</code></pre>
<p>Tsibble works well with ggplot2.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eu_ts2,<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span>value)) <span class="sc">+</span> <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>key,<span class="at">ncol=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/unnamed-chunk-36-1.png" width="672"></p>
<p>Forecasting can be done using the fable package which is a tidy implementation of the classic forecast package by Rob Hyndman. This package is being developed by Hyndman’s student Earo Wang and is currently not available on CRAN</p>
</section>
<section id="model-representation-using-broom" class="level2">
<h2 class="anchored" data-anchor-id="model-representation-using-broom">Model representation using Broom</h2>
<p>Use tidy() to summarize information about models Use glance() to report goodness of fit metrics Use augment() to add information about observations</p>
<p>Produces outputs in a simple tibble</p>
<p>The code below shows what we typically get when building a model</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(mtcars)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>ols_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(hp<span class="sc">~</span> mpg <span class="sc">+</span> cyl, mtcars)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Call:
## lm(formula = hp ~ mpg + cyl, data = mtcars)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -53.72 -22.18 -10.13  14.47 130.73 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)   54.067     86.093   0.628  0.53492   
## mpg           -2.775      2.177  -1.275  0.21253   
## cyl           23.979      7.346   3.264  0.00281 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 38.22 on 29 degrees of freedom
## Multiple R-squared:  0.7093, Adjusted R-squared:  0.6892 
## F-statistic: 35.37 on 2 and 29 DF,  p-value: 1.663e-08</code></pre>
<p>Using tidy from the broom package we get:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(ols_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 3 x 5
##   term        estimate std.error statistic p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)    54.1      86.1      0.628 0.535  
## 2 mpg            -2.77      2.18    -1.27  0.213  
## 3 cyl            24.0       7.35     3.26  0.00281</code></pre>
<p>Using glance</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(ols_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 1 x 11
##   r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC
##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0.709         0.689  38.2      35.4 1.66e-8     3  -160.  329.  335.
## # ... with 2 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<p>Using augment gives information about each observation in the training data</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(ols_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 32 x 11
##    .rownames    hp   mpg   cyl .fitted .se.fit .resid   .hat .sigma .cooksd
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1 Mazda RX4   110  21       6   140.     6.84 -29.7  0.0320   38.5 0.00687
##  2 Mazda RX~   110  21       6   140.     6.84 -29.7  0.0320   38.5 0.00687
##  3 Datsun 7~    93  22.8     4    86.7   13.3    6.28 0.121    38.9 0.00141
##  4 Hornet 4~   110  21.4     6   139.     7.00 -28.6  0.0335   38.5 0.00668
##  5 Hornet S~   175  18.7     8   194.    12.8  -19.0  0.112    38.7 0.0117 
##  6 Valiant     105  18.1     6   148.     8.75 -42.7  0.0524   38.0 0.0243 
##  7 Duster 3~   245  14.3     8   206.     9.79  38.8  0.0656   38.2 0.0258 
##  8 Merc 240D    62  24.4     4    82.3   11.6  -20.3  0.0924   38.7 0.0105 
##  9 Merc 230     95  22.8     4    86.7   13.3    8.28 0.121    38.9 0.00246
## 10 Merc 280    123  19.2     6   145.     7.47 -21.7  0.0382   38.7 0.00443
## # ... with 22 more rows, and 1 more variable: .std.resid &lt;dbl&gt;</code></pre>
<p>To compare multiple models on goodness of fit:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>fits <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">fit1 =</span> <span class="fu">lm</span>(hp<span class="sc">~</span>cyl,mtcars),</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">fit2 =</span> <span class="fu">lm</span>(hp <span class="sc">~</span> cyl <span class="sc">+</span>mpg, mtcars),</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">fit3 =</span> <span class="fu">lm</span>(hp<span class="sc">~</span>. , mtcars))</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="fu">map_df</span>(fits,glance,<span class="at">.id =</span> <span class="st">"model"</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(AIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 3 x 12
##   model r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC
##   &lt;chr&gt;     &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 fit3      0.903         0.857  26.0      19.5 1.90e-8    11  -143.  310.  327.
## 2 fit1      0.693         0.683  38.6      67.7 3.48e-9     2  -161.  329.  333.
## 3 fit2      0.709         0.689  38.2      35.4 1.66e-8     3  -160.  329.  335.
## # ... with 2 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<p>A more realistic application for broom are cases where you want to bootstrap the parameter estimates of a model</p>
<p>Consider the model <span class="math display">\[ mpg = \frac{k}{wt} + b + \epsilon, \sim Normal(0,\sigma^2) \]</span></p>
<p>To estimate the bootstrapped estimates, you can do the following</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>boots <span class="ot">&lt;-</span> <span class="fu">bootstraps</span>(mtcars,<span class="at">times=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Function to fit non linear least squares</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>fit_nls_on_bootstrap <span class="ot">&lt;-</span> <span class="cf">function</span>(split) {</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nls</span>(</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    mpg <span class="sc">~</span> k<span class="sc">/</span>wt <span class="sc">+</span> b,</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">analysis</span>(split),</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">list</span>(<span class="at">k=</span><span class="dv">1</span>,<span class="at">b=</span><span class="dv">0</span>)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Bootstrap as follows:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>boot_fits <span class="ot">&lt;-</span> boots <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">map</span>(splits,fit_nls_on_bootstrap),</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">coef_info =</span> <span class="fu">map</span>(fit,tidy))</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(boot_fits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 6 x 4
##   splits          id           fit       coef_info       
## * &lt;list&gt;          &lt;chr&gt;        &lt;list&gt;    &lt;list&gt;          
## 1 &lt;split [32/13]&gt; Bootstrap001 &lt;S3: nls&gt; &lt;tibble [2 x 5]&gt;
## 2 &lt;split [32/12]&gt; Bootstrap002 &lt;S3: nls&gt; &lt;tibble [2 x 5]&gt;
## 3 &lt;split [32/11]&gt; Bootstrap003 &lt;S3: nls&gt; &lt;tibble [2 x 5]&gt;
## 4 &lt;split [32/13]&gt; Bootstrap004 &lt;S3: nls&gt; &lt;tibble [2 x 5]&gt;
## 5 &lt;split [32/11]&gt; Bootstrap005 &lt;S3: nls&gt; &lt;tibble [2 x 5]&gt;
## 6 &lt;split [32/11]&gt; Bootstrap006 &lt;S3: nls&gt; &lt;tibble [2 x 5]&gt;</code></pre>
<p>Get bootstrapped coefficients</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(resample)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Attaching package: 'resample'</code></pre>
<pre><code>## The following object is masked from 'package:broom':
## 
##     bootstrap</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>mtcars_bs <span class="ot">&lt;-</span> <span class="fu">bootstraps</span>(mtcars,<span class="at">times=</span><span class="dv">20</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>boot_coefs <span class="ot">&lt;-</span> boot_fits <span class="sc">%&gt;%</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">unnest</span>(coef_info)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(boot_coefs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 6 x 6
##   id           term  estimate std.error statistic  p.value
##   &lt;chr&gt;        &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 Bootstrap001 k        41.2       3.38     12.2  3.86e-13
## 2 Bootstrap001 b         5.56      1.23      4.53 8.86e- 5
## 3 Bootstrap002 k        38.8       2.82     13.8  1.66e-14
## 4 Bootstrap002 b         6.52      1.03      6.36 5.15e- 7
## 5 Bootstrap003 k        51.7       4.80     10.8  8.12e-12
## 6 Bootstrap003 b         2.61      1.70      1.53 1.36e- 1</code></pre>
<p>Plot bootstrapped estimates as follows</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(boot_coefs,<span class="fu">aes</span>(estimate))<span class="sc">+</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> term,<span class="at">scales=</span><span class="st">'free'</span>)<span class="sc">+</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Sampling distribution of k and b"</span>,</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="st">"Value"</span> )</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/unnamed-chunk-46-1.png" width="672"></p>
<p>We can also plot the bootstrapped predictions as follows</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>boot_aug <span class="ot">&lt;-</span> boot_fits <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">augmented =</span> <span class="fu">map</span>(fit,augment))<span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">unnest</span>(augmented)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(boot_aug,<span class="fu">aes</span>(wt,mpg))<span class="sc">+</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted,<span class="at">group =</span>id),<span class="at">alpha =</span><span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/unnamed-chunk-47-1.png" width="672"></p>
</section>
<section id="gganimate" class="level2">
<h2 class="anchored" data-anchor-id="gganimate">gganimate</h2>
<p>Package for animated graphics which extends ggplot2. Additional dependencies will have to be installed.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gapminder, <span class="fu">aes</span>(gdpPercap, lifeExp, <span class="at">size =</span> pop, <span class="at">colour =</span> country)) <span class="sc">+</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> country_colors) <span class="sc">+</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here comes the gganimate specific bits</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Year: {frame_time}'</span>, <span class="at">x =</span> <span class="st">'GDP per capita'</span>, <span class="at">y =</span> <span class="st">'life expectancy'</span>) <span class="sc">+</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_time</span>(year) <span class="sc">+</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ease_aes</span>(<span class="st">'linear'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/unnamed-chunk-48-1.gif" class="img-fluid"></p>
</section>
<section id="hypothetical-outcome-plots" class="level2">
<h2 class="anchored" data-anchor-id="hypothetical-outcome-plots">Hypothetical Outcome Plots</h2>
<p>Hypothetical outcome plots provide an alternative way to visualize uncertainty by animating a finite set of individual draws rather than producing a static representation of distributions.</p>
<p>Load required packages.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(transformr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The plot below uses bootstrapped samples to visualize uncertainty in the trend line.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(mtcars)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Draw bootstrap samples</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>mtcars_bs <span class="ot">&lt;-</span> <span class="fu">bootstraps</span>(mtcars,<span class="at">times=</span><span class="dv">20</span>)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>mtcars_bs_df <span class="ot">&lt;-</span> <span class="fu">map_df</span>(mtcars_bs<span class="sc">$</span>splits, <span class="cf">function</span>(x){</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">return</span>(<span class="fu">as.data.frame</span>(x))</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>                        })</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>mtcars_bs_df<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>),<span class="at">each=</span><span class="fu">nrow</span>(mtcars))</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(disp,mpg))<span class="sc">+</span></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()<span class="sc">+</span> </span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> mtcars_bs_df,</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">group =</span>id),</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">alpha =</span> <span class="fl">0.6</span></span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/unnamed-chunk-50-1.png" width="672"></p>
<p>The same can be represented using a hypothetical outcome plot as follows</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>mtcars_bs_df <span class="sc">%&gt;%</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(disp,mpg))<span class="sc">+</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">group =</span>id),<span class="at">se=</span><span class="cn">FALSE</span>,<span class="at">alpha=</span><span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">data=</span>mtcars)<span class="sc">+</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">transition_states</span>(id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/unnamed-chunk-51-1.gif" class="img-fluid"></p>
</section>
<section id="datapasta" class="level2">
<h2 class="anchored" data-anchor-id="datapasta">Datapasta</h2>
<p>If you want to quickly copy some sample data from excel or SQL into R, you often have to convert it into csv or excel file and then import it or type it manually. Datapasta is an R Studio add in that provides a much easier alternative.</p>
<p>After installing the package ‘datapasta’ , simply copy the table from an excel file, go to add ins and select the appropriate option.</p>
<p>Here, I simply copied a table from excel using ‘Ctrl+C’ and then selected ‘Paste as data.frame’ from the add ins dropdown.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">stringsAsFactors=</span><span class="cn">FALSE</span>,</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">Name =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>),</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">Marks =</span> <span class="fu">c</span>(<span class="dv">87</span>L, <span class="dv">35</span>L, <span class="dv">76</span>L, <span class="dv">34</span>L, <span class="dv">86</span>L)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>##   Name Marks
## 1    A    87
## 2    B    35
## 3    C    76
## 4    D    34
## 5    E    86</code></pre>
</section>
<section id="vctrs" class="level2">
<h2 class="anchored" data-anchor-id="vctrs">vctrs</h2>
<p>This is another package from Hadley Wickham designed to make sure that outputs from functions are predictable.</p>
<p>Sometimes, R does not behave predictable. For instance when combining two factors..</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">factor</span>(<span class="st">"a"</span>),<span class="fu">factor</span>(<span class="st">"b"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 1 1</code></pre>
<p>Also..</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>today <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">'2019-02-23'</span>)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>tomorrow <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">"2019-02-23 12:00"</span>,<span class="at">tz =</span> <span class="st">"America/Chicago"</span>)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(today,tomorrow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] "2019-02-23"    "4248312-08-21"</code></pre>
<p>Also..</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="cn">NULL</span>,tomorrow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 1550944800</code></pre>
<p>The vctrs package formalizes the relationships between various datatypes and requires the user to be more explicit when combining different datatypes.</p>
<p>To summarize: Logical –&gt; Integer –&gt; Double Date –&gt; Date-time Factor –&gt;Character Ordered –&gt; Character</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vctrs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Attaching package: 'vctrs'</code></pre>
<pre><code>## The following object is masked from 'package:lubridate':
## 
##     new_duration</code></pre>
<p>When coercing to character , it is stricter than base R. vec_c below would throw an error</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fl">1.5</span>,<span class="st">"a"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] "1.5" "a"</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">#vec_c(1.5,"a")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Instead you have to be explicit..</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vec_c</span>(<span class="fl">1.5</span>,<span class="st">"x"</span>,<span class="at">.ptype =</span> <span class="fu">character</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] "1.5" "x"</code></pre>
<p>Unlike in base R, the following works..</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vec_c</span>(<span class="fu">factor</span>(<span class="st">"a"</span>),<span class="fu">factor</span>(<span class="st">"b"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] a b
## Levels: a b</code></pre>
<p>Note the order affects the levels..</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vec_c</span>(<span class="fu">factor</span>(<span class="st">"b"</span>),<span class="fu">factor</span>(<span class="st">"a"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] b a
## Levels: b a</code></pre>
<p>Similarly when concatenating a factor and an ordered factor…</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">factor</span>(<span class="st">"a"</span>),<span class="fu">ordered</span>(<span class="st">"b"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] 1 1</code></pre>
<p>The first call below would throw an error..</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co">#vec_c(factor("a"),ordered("b"))</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vec_c</span>(<span class="fu">factor</span>(<span class="st">"a"</span>),<span class="fu">ordered</span>(<span class="st">"b"</span>),<span class="at">.ptype =</span> <span class="fu">character</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] "a" "b"</code></pre>
<p>The date problem does not occur here..</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vec_c</span>(today,tomorrow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] "2019-02-23 00:00:00 CST" "2019-02-23 12:00:00 CST"</code></pre>
<p>Disparate datatypes can be combined into a list</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vec_c</span>(today,<span class="fu">factor</span>(<span class="st">"a"</span>),<span class="at">.ptype=</span><span class="fu">list</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [[1]]
## [1] "2019-02-23"
## 
## [[2]]
## [1] a
## Levels: a</code></pre>
</section>
<section id="tidy-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="tidy-evaluation">Tidy Evaluation</h2>
<p>A tool for metaprogramming. This becomes important when you do not know the names of an object in advance and you want to build a tidyverse pipeline which operates on such objects. This is often the case when you have to operate on user inputs, say in a shiny application where you have to make indirect references with column names stored in variables or passed as function arguments.</p>
<p>It is tidy evaluation that really allows you to use column names below without using quotes.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(starwars)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(homeworld <span class="sc">==</span> <span class="st">"Tatooine"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(height)<span class="sc">%&gt;%</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(name,<span class="fu">ends_with</span>(<span class="st">"color"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 10 x 4
##    name               hair_color  skin_color eye_color
##    &lt;chr&gt;              &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;    
##  1 R5-D4              &lt;NA&gt;        white, red red      
##  2 Shmi Skywalker     black       fair       brown    
##  3 Beru Whitesun lars brown       light      blue     
##  4 C-3PO              &lt;NA&gt;        gold       yellow   
##  5 Luke Skywalker     blond       fair       blue     
##  6 Owen Lars          brown, grey light      blue     
##  7 Biggs Darklighter  black       light      brown    
##  8 Cliegg Lars        brown       fair       blue     
##  9 Anakin Skywalker   blond       fair       blue     
## 10 Darth Vader        none        white      yellow</code></pre>
<p>To evaluate an expression, the interpreter searches the environment for name-value bindings. In tidy eval, the expression is modified or the chain of searched environments is modified. This is what allows you to use unquoted variable names and work inside a dataframe. This is also referred to as <strong>non-standard evaluation</strong>.</p>
<p>Tidy eval can be implemented in the following ways..</p>
<ol type="1">
<li>Using ‘…’</li>
</ol>
<div class="sourceCode" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(mtcars)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>measure_hp <span class="ot">&lt;-</span> <span class="cf">function</span>(df,...){</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(...)<span class="sc">%&gt;%</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">avg_hp =</span> <span class="fu">mean</span>(hp,<span class="at">na.rm=</span><span class="cn">TRUE</span>))}</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="fu">measure_hp</span>(mtcars,gear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 3 x 2
##    gear avg_hp
##   &lt;dbl&gt;  &lt;dbl&gt;
## 1     3  176. 
## 2     4   89.5
## 3     5  196.</code></pre>
<ol start="2" type="1">
<li>Using enquo and !!(called ‘bang!bang!’ operator)</li>
</ol>
<div class="sourceCode" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>measure<span class="ot">&lt;-</span> <span class="cf">function</span>(df,group_var,summary_var){</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  group_var <span class="ot">&lt;-</span> <span class="fu">enquo</span>(group_var) <span class="co">#Effectively quotes the variable</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  summary_var <span class="ot">&lt;-</span> <span class="fu">enquo</span>(summary_var)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="sc">!!</span>group_var)<span class="sc">%&gt;%</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">avg_hp =</span> <span class="fu">mean</span>(<span class="sc">!!</span>summary_var,<span class="at">na.rm=</span><span class="cn">TRUE</span>))}</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="fu">measure</span>(mtcars,gear,hp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 3 x 2
##    gear avg_hp
##   &lt;dbl&gt;  &lt;dbl&gt;
## 1     3  176. 
## 2     4   89.5
## 3     5  196.</code></pre>
<p>If you need to manipulate user input that is passed as character strings,you can do the following..</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>group_var <span class="ot">&lt;-</span> <span class="st">'gear'</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>summary_var <span class="ot">&lt;-</span> <span class="st">'hp'</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="fu">measure</span>(mtcars,<span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(group_var),<span class="sc">!!</span>rlang<span class="sc">::</span><span class="fu">sym</span>(summary_var))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 3 x 2
##    gear avg_hp
##   &lt;dbl&gt;  &lt;dbl&gt;
## 1     3  176. 
## 2     4   89.5
## 3     5  196.</code></pre>
<section id="action-and-selection-verbs" class="level3">
<h3 class="anchored" data-anchor-id="action-and-selection-verbs">Action and Selection Verbs</h3>
<p>dplyr verbs comes in two flavors - <strong>action</strong> and <strong>selection</strong>. <strong>select</strong> is a <em>selection</em> verb while verbs like mutate,group_by and transmute are action verbs.</p>
<p>Action verbs created new vectors and modify the dataframe.Selection verbs look up the position of the columns in the dataframe and re-organizes the dataframe.</p>
<p>Selection verbs are context aware and know about current variables.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>height))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 87 x 2
##    name               height
##    &lt;chr&gt;               &lt;int&gt;
##  1 Luke Skywalker        172
##  2 C-3PO                 167
##  3 R2-D2                  96
##  4 Darth Vader           202
##  5 Leia Organa           150
##  6 Owen Lars             178
##  7 Beru Whitesun lars    165
##  8 R5-D4                  97
##  9 Biggs Darklighter     183
## 10 Obi-Wan Kenobi        182
## # ... with 77 more rows</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span>height)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 87 x 2
##    name               height
##    &lt;chr&gt;               &lt;int&gt;
##  1 Luke Skywalker        172
##  2 C-3PO                 167
##  3 R2-D2                  96
##  4 Darth Vader           202
##  5 Leia Organa           150
##  6 Owen Lars             178
##  7 Beru Whitesun lars    165
##  8 R5-D4                  97
##  9 Biggs Darklighter     183
## 10 Obi-Wan Kenobi        182
## # ... with 77 more rows</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span>height)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 87 x 11
##     mass hair_color skin_color eye_color birth_year gender homeworld species
##    &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;  
##  1    77 blond      fair       blue            19   male   Tatooine  Human  
##  2    75 &lt;NA&gt;       gold       yellow         112   &lt;NA&gt;   Tatooine  Droid  
##  3    32 &lt;NA&gt;       white, bl~ red             33   &lt;NA&gt;   Naboo     Droid  
##  4   136 none       white      yellow          41.9 male   Tatooine  Human  
##  5    49 brown      light      brown           19   female Alderaan  Human  
##  6   120 brown, gr~ light      blue            52   male   Tatooine  Human  
##  7    75 brown      light      blue            47   female Tatooine  Human  
##  8    32 &lt;NA&gt;       white, red red             NA   &lt;NA&gt;   Tatooine  Droid  
##  9    84 black      light      brown           24   male   Tatooine  Human  
## 10    77 auburn, w~ fair       blue-gray       57   male   Stewjon   Human  
## # ... with 77 more rows, and 3 more variables: films &lt;list&gt;, vehicles &lt;list&gt;,
## #   starships &lt;list&gt;</code></pre>
<p>You can also use selection helpers as follows..</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">"color"</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 6 x 3
##   hair_color  skin_color  eye_color
##   &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;    
## 1 blond       fair        blue     
## 2 &lt;NA&gt;        gold        yellow   
## 3 &lt;NA&gt;        white, blue red      
## 4 none        white       yellow   
## 5 brown       light       brown    
## 6 brown, grey light       blue</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">matches</span>(<span class="st">"^[nm]a"</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 6 x 2
##   name            mass
##   &lt;chr&gt;          &lt;dbl&gt;
## 1 Luke Skywalker    77
## 2 C-3PO             75
## 3 R2-D2             32
## 4 Darth Vader      136
## 5 Leia Organa       49
## 6 Owen Lars        120</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">10</span>,<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 6 x 13
##   species name  height  mass hair_color skin_color eye_color birth_year gender
##   &lt;chr&gt;   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; 
## 1 Human   Luke~    172    77 blond      fair       blue            19   male  
## 2 Droid   C-3PO    167    75 &lt;NA&gt;       gold       yellow         112   &lt;NA&gt;  
## 3 Droid   R2-D2     96    32 &lt;NA&gt;       white, bl~ red             33   &lt;NA&gt;  
## 4 Human   Dart~    202   136 none       white      yellow          41.9 male  
## 5 Human   Leia~    150    49 brown      light      brown           19   female
## 6 Human   Owen~    178   120 brown, gr~ light      blue            52   male  
## # ... with 4 more variables: homeworld &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
## #   starships &lt;list&gt;</code></pre>
<p>group_by is an action verb, it does not work with selection helpers. The code below does not work.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co">#starwars %&gt;% group_by(ends_with"color")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Instead you can use..</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">group_by_at</span>(<span class="fu">vars</span>(<span class="fu">ends_with</span>(<span class="st">"color"</span>))) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean_height=</span><span class="fu">mean</span>(height))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 67 x 4
## # Groups:   hair_color, skin_color [50]
##    hair_color    skin_color       eye_color mean_height
##    &lt;chr&gt;         &lt;chr&gt;            &lt;chr&gt;           &lt;dbl&gt;
##  1 &lt;NA&gt;          gold             yellow            167
##  2 &lt;NA&gt;          green            black             173
##  3 &lt;NA&gt;          green-tan, brown orange            175
##  4 &lt;NA&gt;          white, blue      red                96
##  5 &lt;NA&gt;          white, red       red                97
##  6 auburn        fair             blue              150
##  7 auburn, grey  fair             blue              180
##  8 auburn, white fair             blue-gray         182
##  9 black         blue, grey       yellow            137
## 10 black         brown            brown             171
## # ... with 57 more rows</code></pre>
</section>
</section>
<section id="profviz" class="level2">
<h2 class="anchored" data-anchor-id="profviz">profviz</h2>
<p>profviz can be used to profile your code, identify modules that slow down the program and take corrective action.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(profvis)</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="co">#profvis::profvis(mtcars %&gt;% lm(mpg ~ wt +cyl,.))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="using-spark-to-scale-out-your-jobs" class="level2">
<h2 class="anchored" data-anchor-id="using-spark-to-scale-out-your-jobs">Using Spark to scale out your jobs</h2>
<p>Spark allows you to leverage compute from mutliple machines by distributing computations across multiple machines. The sparklyr package allows you to leverage the power of Spark through R.</p>
<p>Although we connect to spark running on the local machine below, we can easily connect to a cluster provided by a cloud provider. Make sure Java is installed in a directory which does not have spaces or special characters. This <a href="https://forum.unity.com/threads/could-not-reserve-enough-space-for-object-heap-resolved.88119/">link</a> may also be useful</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sparklyr)                                   <span class="co">#R Interface to Apache Spark</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Attaching package: 'sparklyr'</code></pre>
<pre><code>## The following object is masked from 'package:rlang':
## 
##     invoke</code></pre>
<pre><code>## The following object is masked from 'package:purrr':
## 
##     invoke</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co">#spark_install()                                    #Install Apache Spark</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Add path to java to environment variables</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">JAVA_HOME =</span> <span class="st">'C:/Users/learningmachine/Java/jre1.8.0_201'</span>)</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> <span class="fu">spark_connect</span>(<span class="at">master =</span> <span class="st">'local'</span>)               <span class="co">#Connect to local cluster</span></span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a><span class="do">##Make sure you have the mtcars.csv file in your working directory</span></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>cars_tbl <span class="ot">&lt;-</span> <span class="fu">spark_read_csv</span>(sc,<span class="st">"cars"</span>,<span class="st">"mtcars.csv"</span>)     <span class="co">#Read data into spark</span></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(cars_tbl, <span class="at">n =</span><span class="fu">n</span>())                         <span class="co">#Count records with dplyr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # Source: spark&lt;?&gt; [?? x 1]
##       n
##   &lt;dbl&gt;
## 1    32</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(sc,<span class="st">"SELECT count(*) FROM cars"</span>)          <span class="co"># COunt records with DBI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>##   count(1)
## 1       32</code></pre>
<p>Perform linear regression</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ml_linear_regression</span>(cars_tbl,mpg<span class="sc">~</span>wt<span class="sc">+</span>cyl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## Formula: mpg ~ wt + cyl
## 
## Coefficients:
## (Intercept)          wt         cyl 
##   39.686261   -3.190972   -1.507795</code></pre>
<p>You can also define a pipeline and run it on a spark cluster and save it to disk.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>pipeline <span class="ot">&lt;-</span> <span class="fu">ml_pipeline</span>(sc) <span class="sc">%&gt;%</span>                <span class="co">#Define Spark pipleine</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ft_r_formula</span>(mpg<span class="sc">~</span>wt <span class="sc">+</span> cyl)<span class="sc">%&gt;%</span>    <span class="co">#Add formula translation</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ml_linear_regression</span>()         <span class="co">#Add model to pipeline</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>fitted <span class="ot">&lt;-</span> <span class="fu">ml_fit</span>(pipeline,cars_tbl)</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>fitted</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## PipelineModel (Transformer) with 2 stages
## &lt;pipeline_d2021587785&gt; 
##   Stages 
##   |--1 RFormulaModel (Transformer)
##   |    &lt;r_formula_d201fa95296&gt; 
##   |     (Parameters -- Column Names)
##   |      features_col: features
##   |      label_col: label
##   |     (Transformer Info)
##   |      formula:  chr "mpg ~ wt + cyl" 
##   |--2 LinearRegressionModel (Transformer)
##   |    &lt;linear_regression_d201098f3a&gt; 
##   |     (Parameters -- Column Names)
##   |      features_col: features
##   |      label_col: label
##   |      prediction_col: prediction
##   |     (Transformer Info)
##   |      coefficients:  num [1:2] -3.19 -1.51 
##   |      intercept:  num 39.7 
##   |      num_features:  int 2 
##   |      scale:  num 1</code></pre>
<div class="sourceCode" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ml_save(fitted,"mtcars_model",overwrite = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The sparklyr output of a saved Spark ML Pipeline object is in Scala code, which means that the code can be added to the scheduled Spark ML jobs, and without any dependencies in R.</p>
</section>
<section id="shiny" class="level2">
<h2 class="anchored" data-anchor-id="shiny">Shiny</h2>
<p>Some resources worth exploring on shiny and included in the link shared at the beginning of the document are</p>
<ol type="1">
<li><p>Modules: How to compartmentalize your shiny application into modules for easier maintenance and concurrent development</p></li>
<li><p>Reactlog 2.0: Library built in Javascript that allows for easier debugging by visualizing reactive dependencies in the app. Th goto tool for reactivity debugging</p></li>
</ol>
</section>
<section id="miscellaneous" class="level2">
<h2 class="anchored" data-anchor-id="miscellaneous">Miscellaneous</h2>
<section id="sunburst-charts" class="level3">
<h3 class="anchored" data-anchor-id="sunburst-charts">Sunburst Charts</h3>
<p>Pretty cool visualization for representing hierarchical data using concentric circles.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sunburstR)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>sequences <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system.file</span>(<span class="st">"examples/visit-sequences.csv"</span>,<span class="at">package=</span><span class="st">"sunburstR"</span>)</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">header=</span>F</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sunburst</span>(sequences)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!--html_preserve-->
<div id="htmlwidget-39321f56aaaa463e2c2c" class="sunburst html-widget" style="width:672px;height:480px; position:relative;">
<div>
<div class="sunburst-main">
<div class="sunburst-sequence">

</div>
<div class="sunburst-chart">
<div class="sunburst-explanation" style="visibility:hidden;">

</div>
</div>
</div>
<div class="sunburst-sidebar">
<input type="checkbox" class="sunburst-togglelegend" style="visibility:hidden;">Legend
<div class="sunburst-legend" style="visibility:hidden;">

</div>
</div>
</div>
</div>
<script type="application/json" data-for="htmlwidget-39321f56aaaa463e2c2c">{"x":{"data":{"children":[{"name":"account","children":[{"name":"account","children":[{"name":"account","children":[{"name":"account","children":[{"name":"account","children":[{"name":"account","size":22781,"colname":"X6"},{"name":"end","size":3311,"colname":"X6"},{"name":"home","size":906,"colname":"X6"},{"name":"other","size":1156,"colname":"X6"},{"name":"product","size":5969,"colname":"X6"},{"name":"search","size":692,"colname":"X6"}],"colname":"X5"},{"name":"end","children":[],"size":7059,"colname":"X5"},{"name":"home","children":[{"name":"account","size":396,"colname":"X6"},{"name":"end","size":316,"colname":"X6"},{"name":"home","size":226,"colname":"X6"},{"name":"other","size":87,"colname":"X6"},{"name":"product","size":613,"colname":"X6"},{"name":"search","size":245,"colname":"X6"}],"colname":"X5"},{"name":"other","children":[{"name":"account","size":446,"colname":"X6"},{"name":"end","size":229,"colname":"X6"},{"name":"home","size":91,"colname":"X6"},{"name":"other","size":804,"colname":"X6"},{"name":"product","size":776,"colname":"X6"},{"name":"search","size":48,"colname":"X6"}],"colname":"X5"},{"name":"product","children":[{"name":"account","size":3892,"colname":"X6"},{"name":"end","size":3250,"colname":"X6"},{"name":"home","size":531,"colname":"X6"},{"name":"other","size":252,"colname":"X6"},{"name":"product","size":4876,"colname":"X6"},{"name":"search","size":476,"colname":"X6"}],"colname":"X5"},{"name":"search","children":[{"name":"account","size":521,"colname":"X6"},{"name":"end","size":39,"colname":"X6"},{"name":"home","size":7,"colname":"X6"},{"name":"other","size":8,"colname":"X6"},{"name":"product","size":536,"colname":"X6"},{"name":"search","size":219,"colname":"X6"}],"colname":"X5"}],"colname":"X4"},{"name":"end","children":[],"size":14262,"colname":"X4"},{"name":"home","children":[{"name":"account","children":[{"name":"account","size":434,"colname":"X6"},{"name":"end","size":83,"colname":"X6"},{"name":"home","size":71,"colname":"X6"},{"name":"other","size":39,"colname":"X6"},{"name":"product","size":159,"colname":"X6"},{"name":"search","size":24,"colname":"X6"}],"colname":"X5"},{"name":"end","children":[],"size":722,"colname":"X5"},{"name":"home","children":[{"name":"account","size":103,"colname":"X6"},{"name":"end","size":64,"colname":"X6"},{"name":"home","size":76,"colname":"X6"},{"name":"other","size":57,"colname":"X6"},{"name":"product","size":116,"colname":"X6"},{"name":"search","size":47,"colname":"X6"}],"colname":"X5"},{"name":"other","children":[{"name":"account","size":32,"colname":"X6"},{"name":"end","size":13,"colname":"X6"},{"name":"home","size":21,"colname":"X6"},{"name":"other","size":93,"colname":"X6"},{"name":"product","size":33,"colname":"X6"},{"name":"search","size":6,"colname":"X6"}],"colname":"X5"},{"name":"product","children":[{"name":"account","size":252,"colname":"X6"},{"name":"end","size":304,"colname":"X6"},{"name":"home","size":258,"colname":"X6"},{"name":"other","size":25,"colname":"X6"},{"name":"product","size":573,"colname":"X6"},{"name":"search","size":69,"colname":"X6"}],"colname":"X5"},{"name":"search","children":[{"name":"account","size":119,"colname":"X6"},{"name":"end","size":20,"colname":"X6"},{"name":"home","size":13,"colname":"X6"},{"name":"other","size":1,"colname":"X6"},{"name":"product","size":276,"colname":"X6"},{"name":"search","size":103,"colname":"X6"}],"colname":"X5"}],"colname":"X4"},{"name":"other","children":[{"name":"account","children":[{"name":"account","size":486,"colname":"X6"},{"name":"end","size":99,"colname":"X6"},{"name":"home","size":28,"colname":"X6"},{"name":"other","size":130,"colname":"X6"},{"name":"product","size":172,"colname":"X6"},{"name":"search","size":31,"colname":"X6"}],"colname":"X5"},{"name":"end","children":[],"size":636,"colname":"X5"},{"name":"home","children":[{"name":"account","size":33,"colname":"X6"},{"name":"end","size":42,"colname":"X6"},{"name":"home","size":23,"colname":"X6"},{"name":"other","size":15,"colname":"X6"},{"name":"product","size":61,"colname":"X6"},{"name":"search","size":20,"colname":"X6"}],"colname":"X5"},{"name":"other","children":[{"name":"account","size":312,"colname":"X6"},{"name":"end","size":239,"colname":"X6"},{"name":"home","size":92,"colname":"X6"},{"name":"other","size":741,"colname":"X6"},{"name":"product","size":488,"colname":"X6"},{"name":"search","size":48,"colname":"X6"}],"colname":"X5"},{"name":"product","children":[{"name":"account","size":315,"colname":"X6"},{"name":"end","size":881,"colname":"X6"},{"name":"home","size":84,"colname":"X6"},{"name":"other","size":190,"colname":"X6"},{"name":"product","size":1400,"colname":"X6"},{"name":"search","size":77,"colname":"X6"}],"colname":"X5"},{"name":"search","children":[{"name":"account","size":25,"colname":"X6"},{"name":"end","size":5,"colname":"X6"},{"name":"other","size":1,"colname":"X6"},{"name":"product","size":39,"colname":"X6"},{"name":"search","size":22,"colname":"X6"}],"colname":"X5"}],"colname":"X4"},{"name":"product","children":[{"name":"account","children":[{"name":"account","size":3948,"colname":"X6"},{"name":"end","size":721,"colname":"X6"},{"name":"home","size":154,"colname":"X6"},{"name":"other","size":201,"colname":"X6"},{"name":"product","size":2369,"colname":"X6"},{"name":"search","size":189,"colname":"X6"}],"colname":"X5"},{"name":"end","children":[],"size":7344,"colname":"X5"},{"name":"home","children":[{"name":"account","size":198,"colname":"X6"},{"name":"end","size":239,"colname":"X6"},{"name":"home","size":122,"colname":"X6"},{"name":"other","size":52,"colname":"X6"},{"name":"product","size":526,"colname":"X6"},{"name":"search","size":175,"colname":"X6"}],"colname":"X5"},{"name":"other","children":[{"name":"account","size":120,"colname":"X6"},{"name":"end","size":74,"colname":"X6"},{"name":"home","size":23,"colname":"X6"},{"name":"other","size":226,"colname":"X6"},{"name":"product","size":189,"colname":"X6"},{"name":"search","size":13,"colname":"X6"}],"colname":"X5"},{"name":"product","children":[{"name":"account","size":1863,"colname":"X6"},{"name":"end","size":2561,"colname":"X6"},{"name":"home","size":395,"colname":"X6"},{"name":"other","size":160,"colname":"X6"},{"name":"product","size":5934,"colname":"X6"},{"name":"search","size":407,"colname":"X6"}],"colname":"X5"},{"name":"search","children":[{"name":"account","size":281,"colname":"X6"},{"name":"end","size":37,"colname":"X6"},{"name":"home","size":5,"colname":"X6"},{"name":"other","size":3,"colname":"X6"},{"name":"product","size":594,"colname":"X6"},{"name":"search","size":191,"colname":"X6"}],"colname":"X5"}],"colname":"X4"},{"name":"search","children":[{"name":"account","children":[{"name":"account","size":567,"colname":"X6"},{"name":"end","size":69,"colname":"X6"},{"name":"home","size":26,"colname":"X6"},{"name":"other","size":25,"colname":"X6"},{"name":"product","size":253,"colname":"X6"},{"name":"search","size":78,"colname":"X6"}],"colname":"X5"},{"name":"end","children":[],"size":120,"colname":"X5"},{"name":"home","children":[{"name":"account","size":2,"colname":"X6"},{"name":"end","size":4,"colname":"X6"},{"name":"home","size":3,"colname":"X6"},{"name":"product","size":14,"colname":"X6"},{"name":"search","size":4,"colname":"X6"}],"colname":"X5"},{"name":"other","children":[{"name":"account","size":2,"colname":"X6"},{"name":"end","size":3,"colname":"X6"},{"name":"home","size":4,"colname":"X6"},{"name":"other","size":6,"colname":"X6"},{"name":"product","size":7,"colname":"X6"}],"colname":"X5"},{"name":"product","children":[{"name":"account","size":189,"colname":"X6"},{"name":"end","size":257,"colname":"X6"},{"name":"home","size":33,"colname":"X6"},{"name":"other","size":12,"colname":"X6"},{"name":"product","size":550,"colname":"X6"},{"name":"search","size":192,"colname":"X6"}],"colname":"X5"},{"name":"search","children":[{"name":"account","size":113,"colname":"X6"},{"name":"end","size":27,"colname":"X6"},{"name":"home","size":9,"colname":"X6"},{"name":"other","size":7,"colname":"X6"},{"name":"product","size":208,"colname":"X6"},{"name":"search","size":121,"colname":"X6"}],"colname":"X5"}],"colname":"X4"}],"colname":"X3"},{"name":"end","children":[],"size":49154,"colname":"X3"},{"name":"home","children":[{"name":"account","children":[{"name":"account","children":[{"name":"account","size":470,"colname":"X6"},{"name":"end","size":119,"colname":"X6"},{"name":"home","size":139,"colname":"X6"},{"name":"other","size":42,"colname":"X6"},{"name":"product","size":365,"colname":"X6"},{"name":"search","size":39,"colname":"X6"}],"colname":"X5"},{"name":"end","children":[],"size":273,"colname":"X5"},{"name":"home","children":[{"name":"account","size":72,"colname":"X6"},{"name":"end","size":42,"colname":"X6"},{"name":"home","size":25,"colname":"X6"},{"name":"other","size":11,"colname":"X6"},{"name":"product","size":71,"colname":"X6"},{"name":"search","size":23,"colname":"X6"}],"colname":"X5"},{"name":"other","children":[{"name":"account","size":9,"colname":"X6"},{"name":"end","size":6,"colname":"X6"},{"name":"home","size":7,"colname":"X6"},{"name":"other","size":54,"colname":"X6"},{"name":"product","size":22,"colname":"X6"}],"colname":"X5"},{"name":"product","children":[{"name":"account","size":124,"colname":"X6"},{"name":"end","size":110,"colname":"X6"},{"name":"home","size":60,"colname":"X6"},{"name":"other","size":8,"colname":"X6"},{"name":"product","size":191,"colname":"X6"},{"name":"search","size":25,"colname":"X6"}],"colname":"X5"},{"name":"search","children":[{"name":"account","size":23,"colname":"X6"},{"name":"end","size":1,"colname":"X6"},{"name":"home","size":2,"colname":"X6"},{"name":"product","size":29,"colname":"X6"},{"name":"search","size":11,"colname":"X6"}],"colname":"X5"}],"colname":"X4"},{"name":"end","children":[],"size":2878,"colname":"X4"},{"name":"home","children":[{"name":"account","children":[{"name":"account","size":167,"colname":"X6"},{"name":"end","size":37,"colname":"X6"},{"name":"home","size":43,"colname":"X6"},{"name":"other","size":30,"colname":"X6"},{"name":"product","size":45,"colname":"X6"},{"name":"search","size":14,"colname":"X6"}],"colname":"X5"},{"name":"end","children":[],"size":227,"colname":"X5"},{"name":"home","children":[{"name":"account","size":42,"colname":"X6"},{"name":"end","size":30,"colname":"X6"},{"name":"home","size":82,"colname":"X6"},{"name":"other","size":26,"colname":"X6"},{"name":"product","size":62,"colname":"X6"},{"name":"search","size":21,"colname":"X6"}],"colname":"X5"},{"name":"other","children":[{"name":"account","size":29,"colname":"X6"},{"name":"end","size":7,"colname":"X6"},{"name":"home","size":15,"colname":"X6"},{"name":"other","size":61,"colname":"X6"},{"name":"product","size":22,"colname":"X6"},{"name":"search","size":2,"colname":"X6"}],"colname":"X5"},{"name":"product","children":[{"name":"account","size":83,"colname":"X6"},{"name":"end","size":104,"colname":"X6"},{"name":"home","size":90,"colname":"X6"},{"name":"other","size":14,"colname":"X6"},{"name":"product","size":208,"colname":"X6"},{"name":"search","size":24,"colname":"X6"}],"colname":"X5"},{"name":"search","children":[{"name":"account","size":46,"colname":"X6"},{"name":"end","size":5,"colname":"X6"},{"name":"home","size":6,"colname":"X6"},{"name":"product","size":92,"colname":"X6"},{"name":"search","size":34,"colname":"X6"}],"colname":"X5"}],"colname":"X4"},{"name":"other","children":[{"name":"account","children":[{"name":"account","size":51,"colname":"X6"},{"name":"end","size":9,"colname":"X6"},{"name":"home","size":7,"colname":"X6"},{"name":"other","size":7,"colname":"X6"},{"name":"product","size":24,"colname":"X6"},{"name":"search","size":3,"colname":"X6"}],"colname":"X5"},{"name":"end","children":[],"size":56,"colname":"X5"},{"name":"home","children":[{"name":"account","size":12,"colname":"X6"},{"name":"end","size":22,"colname":"X6"},{"name":"home","size":9,"colname":"X6"},{"name":"other","size":3,"colname":"X6"},{"name":"product","size":26,"colname":"X6"},{"name":"search","size":8,"colname":"X6"}],"colname":"X5"},{"name":"other","children":[{"name":"account","size":34,"colname":"X6"},{"name":"end","size":34,"colname":"X6"},{"name":"home","size":34,"colname":"X6"},{"name":"other","size":104,"colname":"X6"},{"name":"product","size":56,"colname":"X6"},{"name":"search","size":4,"colname":"X6"}],"colname":"X5"},{"name":"product","children":[{"name":"account","size":16,"colname":"X6"},{"name":"end","size":35,"colname":"X6"},{"name":"home","size":17,"colname":"X6"},{"name":"other","size":11,"colname":"X6"},{"name":"product","size":59,"colname":"X6"},{"name":"search","size":3,"colname":"X6"}],"colname":"X5"},{"name":"search","children":[{"name":"account","size":6,"colname":"X6"},{"name":"product","size":6,"colname":"X6"}],"colname":"X5"}],"colname":"X4"},{"name":"product","children":[{"name":"account","children":[{"name":"account","size":409,"colname":"X6"},{"name":"end","size":78,"colname":"X6"},{"name":"home","size":103,"colname":"X6"},{"name":"other","size":26,"colname":"X6"},{"name":"product","size":276,"colname":"X6"},{"name":"search","size":30,"colname":"X6"}],"colname":"X5"},{"name":"end","children":[],"size":1277,"colname":"X5"},{"name":"home","children":[{"name":"account","size":133,"colname":"X6"},{"name":"end","size":220,"colname":"X6"},{"name":"home","size":93,"colname":"X6"},{"name":"other","size":27,"colname":"X6"},{"name":"product","size":579,"colname":"X6"},{"name":"search","size":92,"colname":"X6"}],"colname":"X5"},{"name":"other","children":[{"name":"account","size":5,"colname":"X6"},{"name":"end","size":4,"colname":"X6"},{"name":"home","size":4,"colname":"X6"},{"name":"other","size":20,"colname":"X6"},{"name":"product","size":22,"colname":"X6"},{"name":"search","size":1,"colname":"X6"}],"colname":"X5"},{"name":"product","children":[{"name":"account","size":260,"colname":"X6"},{"name":"end","size":534,"colname":"X6"},{"name":"home","size":296,"colname":"X6"},{"name":"other","size":26,"colname":"X6"},{"name":"product","size":1113,"colname":"X6"},{"name":"search","size":97,"colname":"X6"}],"colname":"X5"},{"name":"search","children":[{"name":"account","size":46,"colname":"X6"},{"name":"end","size":6,"colname":"X6"},{"name":"home","size":5,"colname":"X6"},{"name":"product","size":149,"colname":"X6"},{"name":"search","size":43,"colname":"X6"}],"colname":"X5"}],"colname":"X4"},{"name":"search","children":[{"name":"account","children":[{"name":"account","size":201,"colname":"X6"},{"name":"end","size":27,"colname":"X6"},{"name":"home","size":25,"colname":"X6"},{"name":"other","size":6,"colname":"X6"},{"name":"product","size":72,"colname":"X6"},{"name":"search","size":20,"colname":"X6"}],"colname":"X5"},{"name":"end","children":[],"size":80,"colname":"X5"},{"name":"home","children":[{"name":"account","size":7,"colname":"X6"},{"name":"end","size":5,"colname":"X6"},{"name":"home","size":4,"colname":"X6"},{"name":"product","size":8,"colname":"X6"},{"name":"search","size":12,"colname":"X6"}],"colname":"X5"},{"name":"other","children":[{"name":"end","size":2,"colname":"X6"},{"name":"other","size":3,"colname":"X6"},{"name":"product","size":2,"colname":"X6"},{"name":"search","size":1,"colname":"X6"}],"colname":"X5"},{"name":"product","children":[{"name":"account","size":79,"colname":"X6"},{"name":"end","size":212,"colname":"X6"},{"name":"home","size":68,"colname":"X6"},{"name":"other","size":7,"colname":"X6"},{"name":"product","size":478,"colname":"X6"},{"name":"search","size":156,"colname":"X6"}],"colname":"X5"},{"name":"search","children":[{"name":"account","size":40,"colname":"X6"},{"name":"end","size":25,"colname":"X6"},{"name":"home","size":5,"colname":"X6"},{"name":"other","size":1,"colname":"X6"},{"name":"product","size":170,"colname":"X6"},{"name":"search","size":88,"colname":"X6"}],"colname":"X5"}],"colname":"X4"}],"colname":"X3"},{"name":"other","children":[{"name":"account","children":[{"name":"account","children":[{"name":"account","size":596,"colname":"X6"},{"name":"end","size":131,"colname":"X6"},{"name":"home","size":42,"colname":"X6"},{"name":"other","size":124,"colname":"X6"},{"name":"product","size":270,"colname":"X6"},{"name":"search","size":34,"colname":"X6"}],"colname":"X5"},{"name":"end","children":[],"size":246,"colname":"X5"},{"name":"home","children":[{"name":"account","size":15,"colname":"X6"},{"name":"end","size":15,"colname":"X6"},{"name":"home","size":8,"colname":"X6"},{"name":"other","size":2,"colname":"X6"},{"name":"product","size":43,"colname":"X6"},{"name":"search","size":4,"colname":"X6"}],"colname":"X5"},{"name":"other","children":[{"name":"account","size":98,"colname":"X6"},{"name":"end","size":31,"colname":"X6"},{"name":"home","size":6,"colname":"X6"},{"name":"other","size":123,"colname":"X6"},{"name":"product","size":85,"colname":"X6"},{"name":"search","size":4,"colname":"X6"}],"colname":"X5"},{"name":"product","children":[{"name":"account","size":160,"colname":"X6"},{"name":"end","size":78,"colname":"X6"},{"name":"home","size":24,"colname":"X6"},{"name":"other","size":32,"colname":"X6"},{"name":"product","size":157,"colname":"X6"},{"name":"search","size":13,"colname":"X6"}],"colname":"X5"},{"name":"search","children":[{"name":"account","size":18,"colname":"X6"},{"name":"end","size":1,"colname":"X6"},{"name":"product","size":42,"colname":"X6"},{"name":"search","size":10,"colname":"X6"}],"colname":"X5"}],"colname":"X4"}],"colname":"X3"}],"colname":"X2"}],"colname":"X1"}],"name":"root"},"options":{"legendOrder":null,"colors":null,"valueField":"size","percent":true,"count":false,"explanation":null,"breadcrumb":[],"legend":[],"sortFunction":null,"sumNodes":true}},"evals":[],"jsHooks":[]}</script>
<!--/html_preserve-->
</section>
<section id="rayshader" class="level3">
<h3 class="anchored" data-anchor-id="rayshader">rayshader</h3>
<p>This is a really cool package. According to the documentation:</p>
<p><em>rayshader uses a combination of raytracing, spherical texture mapping, lambertian reflectance, and ambient occlusion to produce hillshades of elevation matrices. Includes water detection and layering functions, programmable color palette generation, several built-in textures, 2D and 3D plotting options, and the ability to export 3D maps to a 3D printable format.</em></p>
<p>Try running the code below to see some really cool 3d visualizations.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rayshader)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>montereybay <span class="sc">%&gt;%</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sphere_shade</span>(<span class="at">texture=</span><span class="st">"imhof2"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_3d</span>(montereybay, <span class="at">zscale=</span><span class="dv">50</span>, <span class="at">water =</span> <span class="cn">TRUE</span>, <span class="at">watercolor=</span><span class="st">"imhof2"</span>,</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a><span class="at">waterlinecolor=</span><span class="st">"white"</span>, <span class="at">waterlinealpha=</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="other-usefulinteresting-resources" class="level2">
<h2 class="anchored" data-anchor-id="other-usefulinteresting-resources">Other useful/interesting resources</h2>
<ol type="1">
<li><p>Best practices for naming files: <a href="https://speakerdeck.com/jennybc/how-to-name-files?slide=27">link</a></p></li>
<li><p>mlflow for tracking ML experiments,sharing and deploying : <a href="https://www.mlflow.org/docs/latest/tutorial.html">link</a></p></li>
<li><p>All the risk calculators at <a href="http://riskcalc.org/" class="uri">http://riskcalc.org/</a> were built by Cleveland Clinic using Shiny</p></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Govind G Nair</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>