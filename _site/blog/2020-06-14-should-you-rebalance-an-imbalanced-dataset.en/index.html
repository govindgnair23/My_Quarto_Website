<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Govind G Nair">
<meta name="dcterms.date" content="2020-06-14">
<meta name="description" content="Impact of rebalancing an imbalanced dataset">

<title>Should you rebalance an imbalanced dataset?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-d166b450ba5a8e9f7a0ab969bf6592c1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-22381ab97ffb8a420d3841344730e94d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Should you rebalance an imbalanced dataset?</h1>
                  <div>
        <div class="description">
          Impact of rebalancing an imbalanced dataset
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Article</div>
                <div class="quarto-category">Machine Learning</div>
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Govind G Nair </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 14, 2020</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#case-1-when-your-model-is-a-good-fit-for-your-data" id="toc-case-1-when-your-model-is-a-good-fit-for-your-data" class="nav-link" data-scroll-target="#case-1-when-your-model-is-a-good-fit-for-your-data">Case 1: When your model is a good fit for your data</a>
  <ul class="collapse">
  <li><a href="#original-data" id="toc-original-data" class="nav-link" data-scroll-target="#original-data">Original Data</a></li>
  <li><a href="#oversampled-data" id="toc-oversampled-data" class="nav-link" data-scroll-target="#oversampled-data">Oversampled Data</a></li>
  <li><a href="#undersampled-data" id="toc-undersampled-data" class="nav-link" data-scroll-target="#undersampled-data">Undersampled data</a></li>
  </ul></li>
  <li><a href="#case-2-when-your-model-is-not-a-good-fit-for-your-data" id="toc-case-2-when-your-model-is-not-a-good-fit-for-your-data" class="nav-link" data-scroll-target="#case-2-when-your-model-is-not-a-good-fit-for-your-data">Case 2: When your model is not a good fit for your data</a>
  <ul class="collapse">
  <li><a href="#original-data-1" id="toc-original-data-1" class="nav-link" data-scroll-target="#original-data-1">Original Data</a></li>
  <li><a href="#oversampled-data-1" id="toc-oversampled-data-1" class="nav-link" data-scroll-target="#oversampled-data-1">Oversampled Data</a></li>
  <li><a href="#undersampled-data-1" id="toc-undersampled-data-1" class="nav-link" data-scroll-target="#undersampled-data-1">Undersampled Data</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next Steps</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This post looks at the impact of rebalancing an imbalanced dataset and seeks to identify some heuristics/rules of thumb to determine when it is appropriate to rebalance an imbalanced dataset through oversampling/undersampling.</p>
</section>
<section id="case-1-when-your-model-is-a-good-fit-for-your-data" class="level2">
<h2 class="anchored" data-anchor-id="case-1-when-your-model-is-a-good-fit-for-your-data">Case 1: When your model is a good fit for your data</h2>
<p>This is the condition where your model has low bias and is an appropriate fit for the data on hand.</p>
<section id="original-data" class="level3">
<h3 class="anchored" data-anchor-id="original-data">Original Data</h3>
<p>Consider the true data you are working with below which is linearly separable. The data is imbalanced with a ratio of 1:4. 20% of the data is held out as a test set.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">'x1'</span><span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">200</span>,<span class="fl">0.6</span>,<span class="fl">0.12</span>),<span class="st">'x2'</span><span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">200</span>,<span class="fl">0.4</span>,<span class="fl">0.15</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>c2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">'x1'</span><span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">800</span>,<span class="fl">0.4</span>,<span class="fl">0.12</span>),<span class="st">'x2'</span><span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">800</span>,<span class="fl">0.6</span>,<span class="fl">0.15</span>))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>original_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rbind</span>(c1,c2))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>original_data<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">200</span>),<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">800</span>)))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Split to train and test sets</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(original_data)),<span class="at">size =</span> <span class="fl">0.8</span><span class="sc">*</span><span class="fu">nrow</span>(original_data),<span class="at">replace=</span><span class="cn">FALSE</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> original_data[train_index,]</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> original_data[<span class="sc">-</span>train_index,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The summary of the datasets are as follows</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(train_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>##        x1                x2           y      
##  Min.   :0.01163   Min.   :-0.03573   0:640  
##  1st Qu.:0.33082   1st Qu.: 0.44024   1:160  
##  Median :0.42874   Median : 0.56336          
##  Mean   :0.43496   Mean   : 0.56103          
##  3rd Qu.:0.53504   3rd Qu.: 0.68092          
##  Max.   :0.91904   Max.   : 1.02417</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(test_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>##        x1                x2         y      
##  Min.   :0.05498   Min.   :0.1563   0:160  
##  1st Qu.:0.34173   1st Qu.:0.4410   1: 40  
##  Median :0.44668   Median :0.5453          
##  Mean   :0.43971   Mean   :0.5510          
##  3rd Qu.:0.52208   3rd Qu.:0.6525          
##  Max.   :0.79505   Max.   :1.0559</code></pre>
<p>A simple logistic regression model is built on the training data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>glm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ ., family = "binomial", data = train_data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.31817  -0.36147  -0.15567  -0.04157   2.72629  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -5.0134     0.7983  -6.280 3.39e-10 ***
## x1           15.0057     1.4026  10.698  &lt; 2e-16 ***
## x2           -7.6975     0.9103  -8.456  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 800.64  on 799  degrees of freedom
## Residual deviance: 394.73  on 797  degrees of freedom
## AIC: 400.73
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>Below is a function to generate a plot of the decision boundaries and the confidence intervals.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>plot_decision_boundary <span class="ot">&lt;-</span> <span class="cf">function</span>(model,boundary,data,title,<span class="at">min_=</span><span class="dv">0</span>,<span class="at">max_=</span><span class="dv">1</span>){</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>grid_dimension <span class="ot">&lt;-</span> <span class="fu">seq</span>(min_,max_,<span class="at">by =</span><span class="fl">0.01</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1=</span>grid_dimension,<span class="at">x2 =</span> grid_dimension)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>grid_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(model,<span class="at">newdata=</span>grid,<span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>preds_ci <span class="ot">&lt;-</span>  <span class="fu">predict</span>(model,<span class="at">newdata=</span>grid,<span class="at">type=</span><span class="st">'link'</span>,<span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate 95% prediction interval bounds</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>critval <span class="ot">&lt;-</span> <span class="fl">1.96</span> <span class="do">## approx 95% CI</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>upr <span class="ot">&lt;-</span> preds_ci<span class="sc">$</span>fit <span class="sc">+</span> (critval <span class="sc">*</span> preds_ci<span class="sc">$</span>se.fit)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>lwr <span class="ot">&lt;-</span> preds_ci<span class="sc">$</span>fit <span class="sc">-</span> (critval <span class="sc">*</span> preds_ci<span class="sc">$</span>se.fit)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">#These are logits, use inverse link function to get probabilties</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>upr2 <span class="ot">&lt;-</span> model<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(upr)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>lwr2 <span class="ot">&lt;-</span> model<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(lwr)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>contour_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(grid,<span class="at">lwr =</span> lwr2,<span class="at">upr =</span>upr2,<span class="at">pred =</span> grid_preds) </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data,<span class="fu">aes</span>(<span class="at">x=</span>x1,<span class="at">y=</span>x2))<span class="sc">+</span><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> <span class="fu">factor</span>(y)),<span class="at">alpha =</span><span class="fl">0.3</span>)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span>title) <span class="sc">+</span> <span class="fu">theme</span> (<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>p<span class="sc">+</span> <span class="fu">stat_contour</span>(<span class="at">data =</span> contour_data,<span class="fu">aes</span>(<span class="at">x =</span> x1,<span class="at">y =</span> x2,<span class="at">z=</span>pred),<span class="at">breaks=</span><span class="fu">c</span>(boundary))<span class="sc">+</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stat_contour</span>(<span class="at">data =</span> contour_data,<span class="fu">aes</span>(<span class="at">x =</span> x1,<span class="at">y =</span> x2,<span class="at">z=</span>lwr),<span class="at">breaks=</span><span class="fu">c</span>(boundary),<span class="at">linetype=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stat_contour</span>(<span class="at">data =</span> contour_data,<span class="fu">aes</span>(<span class="at">x =</span> x1,<span class="at">y =</span> x2,<span class="at">z=</span>upr),<span class="at">breaks=</span><span class="fu">c</span>(boundary),<span class="at">linetype=</span><span class="dv">2</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The plot of the decision boundary and 95% confidence intervals from the model are shown below.The decision boundary is a contour corresponding to a probability of 0.2 given this is the proportion of the target class in the dataset.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_decision_boundary</span>(glm1,<span class="at">boundary=</span><span class="fl">0.2</span>,<span class="at">data=</span>original_data,<span class="at">title=</span> <span class="st">'Original Data'</span>,<span class="at">min_=</span><span class="dv">0</span>,<span class="at">max_=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/plot1-1.png" width="672"></p>
<p>The overall performance of the model on the test dataset is shown below.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>test_pred_probs1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm1,<span class="at">newdata =</span> test_data,<span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>roc1 <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_data<span class="sc">$</span>y,test_pred_probs1) </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc1,<span class="at">print.auc=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/unnamed-chunk-4-1.png" width="672"></p>
</section>
<section id="oversampled-data" class="level3">
<h3 class="anchored" data-anchor-id="oversampled-data">Oversampled Data</h3>
<p>Now we oversample the minority class so that both classes are balanced.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROSE)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>train_data_1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(train_data<span class="sc">$</span>y<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>oversampled_data <span class="ot">&lt;-</span> <span class="fu">ovun.sample</span>(y<span class="sc">~</span>.,<span class="at">data=</span>train_data,<span class="at">method=</span><span class="st">'over'</span>,<span class="at">N =</span> <span class="dv">2</span><span class="sc">*</span>train_data_1)<span class="sc">$</span>data</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(oversampled_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>##        x1                x2           y      
##  Min.   :0.01163   Min.   :-0.03573   0:640  
##  1st Qu.:0.38328   1st Qu.: 0.38133   1:640  
##  Median :0.50435   Median : 0.50109          
##  Mean   :0.49718   Mean   : 0.50539          
##  3rd Qu.:0.60212   3rd Qu.: 0.63095          
##  Max.   :0.91904   Max.   : 1.02417</code></pre>
<p>A second model is fitted on the oversampled data. Given we have more data, the standard error of the parameter estimates have reduced.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>glm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> ., <span class="at">data =</span> oversampled_data, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ ., family = "binomial", data = oversampled_data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.99430  -0.35839   0.00092   0.45946   2.30790  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -4.4832     0.5698  -7.867 3.62e-15 ***
## x1           17.1126     1.0804  15.839  &lt; 2e-16 ***
## x2           -8.1692     0.6549 -12.474  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1774.46  on 1279  degrees of freedom
## Residual deviance:  781.99  on 1277  degrees of freedom
## AIC: 787.99
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>The decision boundary corresponding to a contour of probability = 0.5 (given the data is balanced) is shown below with a 95% confidence limits .</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_decision_boundary</span>(glm2,<span class="at">boundary=</span><span class="fl">0.5</span>,<span class="at">data=</span>oversampled_data,<span class="at">title=</span> <span class="st">'Oversampled Data'</span>,<span class="at">min_=</span><span class="dv">0</span>,<span class="at">max_=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/oversampled_data_plot-1.png" width="672"></p>
<p>As expected the width of confidence intervals of the regression line shrink since we are now using more data.</p>
<p>The overall performance of the new model on the test dataset is shown below.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>test_pred_probs2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm2,<span class="at">newdata =</span> test_data,<span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>roc2 <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_data<span class="sc">$</span>y,test_pred_probs2) </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc2,<span class="at">print.auc=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>As seen above, the performance of the model built on the oversampled data is only marginally better than on the imbalanced data.The difference is not statistically significant</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">roc.test</span>(roc1,roc2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
##  DeLong's test for two correlated ROC curves
## 
## data:  roc1 and roc2
## Z = 0.9998, p-value = 0.3174
## alternative hypothesis: true difference in AUC is not equal to 0
## sample estimates:
## AUC of roc1 AUC of roc2 
##   0.9362500   0.9348437</code></pre>
</section>
<section id="undersampled-data" class="level3">
<h3 class="anchored" data-anchor-id="undersampled-data">Undersampled data</h3>
<p>Now we try undersampling the majority class. Given this amounts to throwing away useful information,this is typically done only when the data is really big and the tools/infrastructure being used does not support large data sets.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>train_data_0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(train_data<span class="sc">$</span>y<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>undersampled_data <span class="ot">&lt;-</span> <span class="fu">ovun.sample</span>(y<span class="sc">~</span>.,<span class="at">data=</span>train_data,<span class="at">method=</span><span class="st">'under'</span>,<span class="at">N =</span> <span class="dv">2</span><span class="sc">*</span>train_data_0)<span class="sc">$</span>data</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(undersampled_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>##        x1                x2           y      
##  Min.   :0.01163   Min.   :-0.03573   0:160  
##  1st Qu.:0.37429   1st Qu.: 0.36955   1:160  
##  Median :0.50291   Median : 0.49148          
##  Mean   :0.48858   Mean   : 0.50101          
##  3rd Qu.:0.59854   3rd Qu.: 0.63293          
##  Max.   :0.91904   Max.   : 1.02417</code></pre>
<p>A third model is fitted on the undersampled data. Given undersampling reduces the amount of data we are using, the standard error of the parameter estimates increase.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>glm3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> ., <span class="at">data =</span> undersampled_data, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ ., family = "binomial", data = undersampled_data)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.74148  -0.31754  -0.00045   0.42250   2.28722  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   -5.352      1.177  -4.546 5.46e-06 ***
## x1            18.465      2.362   7.818 5.35e-15 ***
## x2            -7.597      1.220  -6.227 4.76e-10 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 443.61  on 319  degrees of freedom
## Residual deviance: 186.63  on 317  degrees of freedom
## AIC: 192.63
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>The plot is shown below with a 95% confidence limits. The confidence interval around the decision boundary has also expanded.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_decision_boundary</span>(glm3,<span class="at">boundary=</span><span class="fl">0.5</span>,<span class="at">data=</span>undersampled_data,<span class="at">title=</span> <span class="st">'Undersampled Data'</span>,<span class="at">min_=</span><span class="dv">0</span>,<span class="at">max_=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/undersampled_plot-1.png" width="672"></p>
<p>The performance of this new model on the test dataset is shown below.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>test_pred_probs3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm3,<span class="at">newdata =</span> test_data,<span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>roc3 <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_data<span class="sc">$</span>y,test_pred_probs3) </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc3,<span class="at">print.auc=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>As seen above, the performance of the model built on the undersampled data is again only marginally better than on the imbalanced data.The difference in performance is again not statistically significant</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">roc.test</span>(roc1,roc3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
##  DeLong's test for two correlated ROC curves
## 
## data:  roc1 and roc3
## Z = 1.4806, p-value = 0.1387
## alternative hypothesis: true difference in AUC is not equal to 0
## sample estimates:
## AUC of roc1 AUC of roc2 
##   0.9362500   0.9321875</code></pre>
</section>
</section>
<section id="case-2-when-your-model-is-not-a-good-fit-for-your-data" class="level2">
<h2 class="anchored" data-anchor-id="case-2-when-your-model-is-not-a-good-fit-for-your-data">Case 2: When your model is not a good fit for your data</h2>
<p>Now consider the case when the model is not a good fit for the data.This refers to the scenario when you chooses a model with high bias.</p>
<section id="original-data-1" class="level3">
<h3 class="anchored" data-anchor-id="original-data-1">Original Data</h3>
<p>The data is again partitioned into train and test sets as earlier.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#class 1</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">'x1'</span><span class="ot">=</span><span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">100</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span>),<span class="fu">rnorm</span>(<span class="dv">100</span>,<span class="fl">0.8</span>,<span class="fl">0.1</span>)),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">'x2'</span><span class="ot">=</span><span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">100</span>,<span class="fl">0.8</span>,<span class="fl">0.1</span>),<span class="fu">rnorm</span>(<span class="dv">100</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span>)))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">#class2</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>c2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">'x1'</span><span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">800</span>,<span class="fl">0.5</span>,<span class="fl">0.1</span>),<span class="st">'x2'</span><span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">800</span>,<span class="fl">0.5</span>,<span class="fl">0.1</span>))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>original_data2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rbind</span>(c1,c2))</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>original_data2<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">200</span>),<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">800</span>)))</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Split to train and test sets</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(original_data2)),<span class="at">size =</span> <span class="fl">0.8</span><span class="sc">*</span><span class="fu">nrow</span>(original_data2),<span class="at">replace=</span><span class="cn">FALSE</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>train_data2 <span class="ot">&lt;-</span> original_data2[train_index,]</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>test_data2 <span class="ot">&lt;-</span> original_data2[<span class="sc">-</span>train_index,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Summary of the datasets are shown below.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(train_data2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>##        x1                 x2          y      
##  Min.   :-0.02239   Min.   :0.02793   0:640  
##  1st Qu.: 0.40243   1st Qu.:0.40536   1:160  
##  Median : 0.49068   Median :0.49987          
##  Mean   : 0.49655   Mean   :0.49993          
##  3rd Qu.: 0.59524   3rd Qu.:0.59498          
##  Max.   : 1.06587   Max.   :1.05071</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(test_data2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>##        x1               x2          y      
##  Min.   :0.0460   Min.   :0.04276   0:160  
##  1st Qu.:0.4038   1st Qu.:0.40692   1: 40  
##  Median :0.5000   Median :0.48628          
##  Mean   :0.4968   Mean   :0.49700          
##  3rd Qu.:0.5847   3rd Qu.:0.59146          
##  Max.   :0.9625   Max.   :0.96148</code></pre>
<p>A model is fitted on the original data.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>glm4 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> ., <span class="at">data =</span> train_data2, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ ., family = "binomial", data = train_data2)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.7455  -0.6777  -0.6607  -0.6341   1.9051  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  -1.9080     0.6226  -3.065  0.00218 **
## x1            0.6119     0.6880   0.889  0.37381   
## x2            0.4319     0.6726   0.642  0.52077   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 800.64  on 799  degrees of freedom
## Residual deviance: 799.84  on 797  degrees of freedom
## AIC: 805.84
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>The plot is shown below</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_decision_boundary</span>(glm4,<span class="at">boundary=</span><span class="fl">0.2</span>,<span class="at">data=</span> original_data2,<span class="at">title=</span> <span class="st">'Original Data'</span>,<span class="at">min_=</span><span class="dv">0</span>,<span class="at">max_=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/original_data_plot2-1.png" width="672"></p>
<p>It can be seen above that the model is mis-specified for the data given and the decision boundary learned is biased.</p>
<p>The performance of this new model on the test dataset has predictably deteriorated.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>test_pred_probs4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm4,<span class="at">newdata =</span> test_data2,<span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>roc4 <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_data2<span class="sc">$</span>y,test_pred_probs4) </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc4,<span class="at">print.auc=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/unnamed-chunk-15-1.png" width="672"></p>
</section>
<section id="oversampled-data-1" class="level3">
<h3 class="anchored" data-anchor-id="oversampled-data-1">Oversampled Data</h3>
<p>Now we oversample the minority class.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>train_data_0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(train_data2<span class="sc">$</span>y<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>oversampled_data2 <span class="ot">&lt;-</span> <span class="fu">ovun.sample</span>(y<span class="sc">~</span>.,<span class="at">data=</span>train_data2,<span class="at">method=</span><span class="st">'over'</span>,<span class="at">N =</span> <span class="dv">2</span><span class="sc">*</span>train_data_0)<span class="sc">$</span>data</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(oversampled_data2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>##        x1                 x2          y      
##  Min.   :-0.02239   Min.   :0.02793   0:640  
##  1st Qu.: 0.32077   1st Qu.:0.32272   1:640  
##  Median : 0.48765   Median :0.50195          
##  Mean   : 0.49570   Mean   :0.50277          
##  3rd Qu.: 0.67683   3rd Qu.:0.66858          
##  Max.   : 1.06587   Max.   :1.05071</code></pre>
<p>A second model is fitted on the oversampled data. As expected, the standard error of the parameter estimates has decreased given we are now using more data.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>glm5 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> ., <span class="at">data =</span> oversampled_data2, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ ., family = "binomial", data = oversampled_data2)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.25580  -1.17644   0.01662   1.17775   1.24644  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept)  -0.4073     0.3988  -1.021    0.307
## x1            0.3969     0.4244   0.935    0.350
## x2            0.4188     0.4049   1.034    0.301
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1774.5  on 1279  degrees of freedom
## Residual deviance: 1773.4  on 1277  degrees of freedom
## AIC: 1779.4
## 
## Number of Fisher Scoring iterations: 3</code></pre>
<p>The plot is shown below. Oversampling does not make any material difference to the decision boundary.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_decision_boundary</span>(glm5,<span class="at">boundary=</span><span class="fl">0.5</span>,<span class="at">data=</span> oversampled_data2,<span class="at">title=</span> <span class="st">'Oversampled Data'</span>,<span class="at">min_=</span><span class="dv">0</span>,<span class="at">max_=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/oversampeld_data_plot2-1.png" width="672"></p>
<p>The performance of this new model is shown below.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>test_pred_probs5 <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm5,<span class="at">newdata =</span> test_data2,<span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>roc5 <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_data2<span class="sc">$</span>y,test_pred_probs5) </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc5,<span class="at">print.auc=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/unnamed-chunk-18-1.png" width="672"></p>
<p>The performance of the model has actually deteriorated after oversampling.</p>
</section>
<section id="undersampled-data-1" class="level3">
<h3 class="anchored" data-anchor-id="undersampled-data-1">Undersampled Data</h3>
<p>Now we undersample the majority class.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>train_data_1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(train_data2<span class="sc">$</span>y<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>undersampled_data2 <span class="ot">&lt;-</span> <span class="fu">ovun.sample</span>(y<span class="sc">~</span>.,<span class="at">data=</span>train_data2,<span class="at">method=</span><span class="st">'under'</span>,<span class="at">N =</span> <span class="dv">2</span><span class="sc">*</span>train_data_1)<span class="sc">$</span>data</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(undersampled_data2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>##        x1                 x2          y      
##  Min.   :-0.02239   Min.   :0.02793   0:160  
##  1st Qu.: 0.32501   1st Qu.:0.34263   1:160  
##  Median : 0.47918   Median :0.49461          
##  Mean   : 0.49348   Mean   :0.49942          
##  3rd Qu.: 0.67674   3rd Qu.:0.64952          
##  Max.   : 1.06587   Max.   :1.05071</code></pre>
<p>A second model is fitted on the undersampled data. Given the amount of data used has shrunk, the standard error of the parameter estimates is higher than in the original data.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>glm6 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> ., <span class="at">data =</span> undersampled_data2, <span class="at">family =</span> <span class="st">'binomial'</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ ., family = "binomial", data = undersampled_data2)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.34987  -1.16813   0.01669   1.17236   1.42414  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept)  -1.2904     0.8229  -1.568    0.117
## x1            1.4033     0.8691   1.615    0.106
## x2            1.1970     0.8504   1.408    0.159
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 443.61  on 319  degrees of freedom
## Residual deviance: 440.95  on 317  degrees of freedom
## AIC: 446.95
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>The plot is shown below. Undersampling again does not make any material difference to the decision boundary.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_decision_boundary</span>(glm6,<span class="at">boundary=</span><span class="fl">0.5</span>,<span class="at">data=</span> undersampled_data2,<span class="at">title=</span> <span class="st">'Undersampled Data'</span>,<span class="at">min_=</span><span class="dv">0</span>,<span class="at">max_=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/undersampled_data_plot2-1.png" width="672"></p>
<p>The performance of this new model is shown below.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>test_pred_probs6 <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm6,<span class="at">newdata =</span> test_data2,<span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>roc6 <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_data2<span class="sc">$</span>y,test_pred_probs6) </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc6,<span class="at">print.auc=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="./figure-html/unnamed-chunk-21-1.png" width="672"></p>
<p>The performance of the model built on undersampled data is also worse than that on the original data.</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<ol type="1">
<li><p>If a model is correctly specified,rebalancing the data with undersampling/oversampling may marginally improve the performance of the model but the difference in performance is not statistically significant and unlikely to materially impact business outcomes</p></li>
<li><p>If the model is incorrectly specified, rebalancing the data does help such a model learn the correct decision boundary and the performance of the resulting model is likely to get worse and almost certainly will not be materially better.</p></li>
<li><p>If you have an imbalanced dataset, you should probably try to engineer new features or use a different model with lower bias before trying to rebalance the dataset.</p></li>
<li><p>Oversampling the dataset can be an effective strategy if your cost of false negatives is much higher than that of false positives, in this case you care more about your recall than your precision, so you would want to overweight your target class by oversampling them.</p></li>
</ol>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next Steps</h2>
<p>I will expand this analysis to include real world datasets. In several blog posts on imbalanced learning, I have seen that baselines without rebalancing are not presented for a fair comparison. In other cases, the thresholds for the model built on imbalanced data are chosen as 0.5 by default instead of carefully selecting the threshold to maximize an appropriate performance metric. This often results in the performance of some of these rebalancing techniques being exaggerated.</p>
<p>In a subsequent blog post or an extension to this one,I will also evaluate some of the commonly used synthetic data generation techniques and try to identify some heuristics around when they might add value.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Govind G Nair</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>