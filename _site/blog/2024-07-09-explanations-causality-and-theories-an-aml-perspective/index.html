<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">
<meta name="dcterms.date" content="2024-07-13">
<meta name="description" content="Bringing scientific rigor to the practice of AML">

<title>Explanations, Causality and Theories - An AML Perspective</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-d166b450ba5a8e9f7a0ab969bf6592c1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-22381ab97ffb8a420d3841344730e94d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Explanations, Causality and Theories - An AML Perspective</h1>
                  <div>
        <div class="description">
          Bringing scientific rigor to the practice of AML
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Article</div>
                <div class="quarto-category">Anti Money Laundering</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">Statistics</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 13, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#theories-and-explanations" id="toc-theories-and-explanations" class="nav-link active" data-scroll-target="#theories-and-explanations">Theories and Explanations</a>
  <ul class="collapse">
  <li><a href="#hard-to-vary." id="toc-hard-to-vary." class="nav-link" data-scroll-target="#hard-to-vary.">Hard to vary.</a></li>
  <li><a href="#falsifiable" id="toc-falsifiable" class="nav-link" data-scroll-target="#falsifiable">Falsifiable</a></li>
  <li><a href="#reach" id="toc-reach" class="nav-link" data-scroll-target="#reach">Reach</a></li>
  </ul></li>
  <li><a href="#causality" id="toc-causality" class="nav-link" data-scroll-target="#causality">Causality</a></li>
  <li><a href="#simpsons-paradox" id="toc-simpsons-paradox" class="nav-link" data-scroll-target="#simpsons-paradox">Simpson’s Paradox</a></li>
  <li><a href="#the-why-in-aml" id="toc-the-why-in-aml" class="nav-link" data-scroll-target="#the-why-in-aml">The Why in AML</a>
  <ul class="collapse">
  <li><a href="#why-is-an-episode-of-transactional-activity-suspicious" id="toc-why-is-an-episode-of-transactional-activity-suspicious" class="nav-link" data-scroll-target="#why-is-an-episode-of-transactional-activity-suspicious">Why is an episode of transactional activity suspicious ?</a></li>
  <li><a href="#transaction-monitoring-systems-need-to-evolve" id="toc-transaction-monitoring-systems-need-to-evolve" class="nav-link" data-scroll-target="#transaction-monitoring-systems-need-to-evolve">Transaction Monitoring Systems need to evolve</a></li>
  </ul></li>
  <li><a href="#the-problem-with-aml-detection-models" id="toc-the-problem-with-aml-detection-models" class="nav-link" data-scroll-target="#the-problem-with-aml-detection-models">The Problem with AML Detection Models</a></li>
  <li><a href="#bridging-this-gap" id="toc-bridging-this-gap" class="nav-link" data-scroll-target="#bridging-this-gap">Bridging This Gap</a></li>
  <li><a href="#theory-of-transaction-monitoring" id="toc-theory-of-transaction-monitoring" class="nav-link" data-scroll-target="#theory-of-transaction-monitoring">Theory of Transaction Monitoring</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<blockquote class="blockquote">
<p>Science is the sum total of human knowledge gained by man through experimentation and observation</p>
</blockquote>
<p>This is the definition of science I recall from my days in middle school. Alas, it is incomplete. It omits perhaps the most important step of the scientific method - conjecture.</p>
<section id="theories-and-explanations" class="level1">
<h1>Theories and Explanations</h1>
<p>The scientific method is a four step process</p>
<ol type="1">
<li><p>Formulate a hypothesis: This initial step involves creating a conjecture or educated guess based on existing knowledge or observations. It sets the stage for experimentation. <br></p></li>
<li><p>Deduce testable consequences of the hypothesis: This step involves making predictions that can be tested through experimentation. <br></p></li>
<li><p>Perform an experiment and collect evidence: Conduct experiments to gather data and observe outcomes. <br></p></li>
<li><p>Update your belief in the hypothesis: Based on the experimental evidence, revise or discard the hypothesis. <br></p></li>
</ol>
<p>If your hypothesis withstands repeated testing, it evolves into a theory supported by a larger body of evidence. If it does not, you discard your hypothesis and the process begins anew.</p>
<p>Formulating a hypothesis or conjecturing is perhaps the hardest of these steps as it requires imagination like Einstein or even courage like Copernicus.</p>
<p>Critiquing a conjecture through steps 2 - 4 of the scientific method ensures that only valid hypotheses survive and grow into scientific theories. Science, like capitalism thrives in creative destruction.</p>
<p>David Deutch, a pioneering quantum physicist argues that good scientific theories don’t just fit the data and produce good predictions; they also provide good explanations of the underlying mechanisms that produce the phenomenon in question.Good theories explain what causes a phenomenon - they should also be causal explanations.</p>
<p>According to Deutch, a good explanatory theory should meet the following criteria.</p>
<section id="hard-to-vary." class="level2">
<h2 class="anchored" data-anchor-id="hard-to-vary.">Hard to vary.</h2>
<p>In his book “The Beginning of Infinity”,Deutch uses Norse mythology as an example of a theory that is easy to vary.</p>
<p>According to Norse mythology,the seasons change according to the fortunes of Freyr, the god of spring, in his eternal war with the forces of cold and darkness. When Freyr wins, the earth experiences summer while when he loses, winter sets in. This is a poor explanation because any variation in the seasons can be attributed to Freyr’s vicissitudes.It is extremely easy to vary to fit any observation.<strong>Such explanations are not even worth testing</strong>.</p>
<p>In contrast,the Tilt theory of seasons correctly explains that seasons are caused by the tilt of the earth’s axis of rotation relative to the plane of orbit.The hemisphere in which the sun’s rays fall vertically have summer while the hemisphere where the rays strike obliquely have winter. This theory, constrained by what we know about geometry,heat and mechanics of the earth’s motion is much harder to vary and is thus a much better explanation.</p>
</section>
<section id="falsifiable" class="level2">
<h2 class="anchored" data-anchor-id="falsifiable">Falsifiable</h2>
<p>Falsifiability, introduced by Karl Popper, is a necessary criterion which makes a theory scientific. A theory has to make testable predictions which can be validated through observations. A scientific theory should thus be falsifiable.</p>
<p>The tilt theory of seasons, for example can make predictions for seasons in both hemispheres. If these predictions are refuted, the theory can be discarded.</p>
<p>Interestingly, the Norse myth is also falsifiable. As per the myth, if Freyr is winning, the whole earth will enjoy summer which is easily disproved by observing different seasons in the northern and southern hemispheres. Falsifiability is thus a necessary not a sufficient criterion for a scientific theory.</p>
</section>
<section id="reach" class="level2">
<h2 class="anchored" data-anchor-id="reach">Reach</h2>
<p>A powerful explanatory theory will also have <strong>reach</strong>. A theory with reach will be applicable to a wide variety of cases and phenomenon beyond its original scope.</p>
<p>Einstein’s theory of general relativity is perhaps the finest example of a theory with reach. Einstein’s field equations predicted the existence of black holes and gravitational waves, something that never occurred to Einstein when he originally formulated the theory.</p>
</section>
</section>
<section id="causality" class="level1">
<h1>Causality</h1>
<p>Good theories should be causal. But what does it mean to say C causes E ?</p>
<p>According to the counterfactual definition of causality, if C is a cause of E, then E would not have occurred if not for C. In other words, if we could imagine a world where everything else remains the same but C did not happen; then if C is the cause of E;E would not have occurred.</p>
<p>This is also referred to as “but-for causation” in legal circles.For example,if a defendant fired a gun(C) and the bullet killed the victim(E), the firing of a gun is a “but-for” or “necessary” cause of death. If we imagine a world where the defendant did not fire his gun, the victim would still be alive.</p>
<p>A more stringent version of causation is sufficient causation.A cause C is considered Sufficient for an effect E if the presence of C guarantees the occurrence of E. Consider someone lighting a match that causes a fire to break out. Now, the presence of oxygen and the act of lighting a match are both necessary causes for the fire. The fire would not have occurred in the absence of one of them. However, only lighting the match is a sufficient cause for the fire.</p>
<p>In the hard sciences, theories are almost always causal and provides an explanation of the underlying mechanism of a phenomenon. However, this is not always the case in the social sciences. When theories are not carefully constructed to account for the true data generating process, data analysis can often lead us astray. The Simpson’s paradox is a notable example of this.</p>
</section>
<section id="simpsons-paradox" class="level1">
<h1>Simpson’s Paradox</h1>
<p>The most striking example of the Simpson’s paradox occurred in 1973 when Eugene Hammel, the associate dean at the University of California,Berkeley observed a concerning trend in the university’s admission rates for men and women. The data showed that only 44 percent of men who applied to graduate school had been accepted compared to 30 percent of women.</p>
<p>A version of the data used for this study is available in the <code>rethinking</code> package in R.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"UCBadmit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>At the university level, we can calculate the admission rate for both men and women.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>UCBadmit <span class="sc">%&gt;%</span> <span class="fu">select</span>(applicant.gender,admit,applications)<span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(applicant.gender) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summarize</span>(<span class="at">Total_admit =</span> <span class="fu">sum</span>(admit),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Total_applications =</span> <span class="fu">sum</span>(applications))<span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">Admit_rate =</span> Total_admit<span class="sc">/</span>Total_applications<span class="sc">*</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 2 × 4
##   applicant.gender Total_admit Total_applications Admit_rate
##   &lt;fct&gt;                  &lt;int&gt;              &lt;int&gt;      &lt;dbl&gt;
## 1 female                   557               1835       30.4
## 2 male                    1198               2691       44.5</code></pre>
<p>This suggests there is clear evidence of bias in favor of men assuming all applicants are equally qualified. However, if we look at this data at a department level the results can lead us to the opposite conclusion.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>UCBadmit <span class="sc">%&gt;%</span> <span class="fu">select</span>(dept, applicant.gender,admit,applications)<span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>(dept,applicant.gender) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summarize</span>(<span class="at">Total_admit =</span> <span class="fu">sum</span>(admit),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Total_applications =</span> <span class="fu">sum</span>(applications))<span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">Admit_rate =</span> Total_admit<span class="sc">/</span>Total_applications<span class="sc">*</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## # A tibble: 12 × 5
## # Groups:   dept [6]
##    dept  applicant.gender Total_admit Total_applications Admit_rate
##    &lt;fct&gt; &lt;fct&gt;                  &lt;int&gt;              &lt;int&gt;      &lt;dbl&gt;
##  1 A     female                    89                108      82.4 
##  2 A     male                     512                825      62.1 
##  3 B     female                    17                 25      68   
##  4 B     male                     353                560      63.0 
##  5 C     female                   202                593      34.1 
##  6 C     male                     120                325      36.9 
##  7 D     female                   131                375      34.9 
##  8 D     male                     138                417      33.1 
##  9 E     female                    94                393      23.9 
## 10 E     male                      53                191      27.7 
## 11 F     female                    24                341       7.04
## 12 F     male                      22                373       5.90</code></pre>
<p>In 4 out of 6 departments, the admission rate for females is actually higher than that of males. Now which is the correct way of interpreting the data ?</p>
<p>This discrepancy requires an understanding of the data generating mechanism. Admission decisions at Berkeley were taken independently by each department,so an admit/reject decision could be influenced by the department to which an applicant applied.</p>
<p>This mechanism can easily be captured using a causal diagram.</p>
<div class="figure">
<p><img src="./images/dag1.png" alt="Causal Diagram of Admissions Outcomes"></p>
<p class="caption">
</p><p>Figure 1: Causal Diagram of Admissions Outcomes</p>
<p></p>
</div>
<p>This causal diagram indicates that there is a direct impact of gender(G) on admission outcomes(O) as well as an indirect effect mediated through Department(D). To study the possibility of discrimination, we are only interested in the direct effect of gender on outcomes. So we need to mute the indirect effect of Gender through Department.</p>
<p>If you are familiar with causal diagrams, you will realize that G-&gt;D-&gt;O is a “pipe”, and this path can be blocked by conditioning on D. In other words, we should analyze the data at the department level. This analysis leads us to conclude that there was indeed no systematic discrimination against women at UC Berkeley.</p>
<p>Now consider the possibility that the state of residence also impacts the department to which a candidate applies and the outcome of the application. Perhaps a state has excellent prep schools for certain disciplines or the head of admissions of each department has a bias towards his or her home state.</p>
<p>In this case, the causal diagram will also include the State of Residence(S) as shown below.</p>
<div class="figure">
<p><img src="./images/dag2.png" alt=" Alternate Causal Diagram of Admissions Outcomes"></p>
<p class="caption">
</p><p>Figure 2: Alternate Causal Diagram of Admissions Outcomes</p>
<p></p>
</div>
<p>Here you might recognize that G-&gt;D&lt;-S is a collider and conditioning on D opens a spurious path G-&gt;D&lt;-S-&gt;O. In fact, to block all indirect effects, you have to also condition on S.</p>
<p>Even if you do not follow the details, the key takeaway is that your theory about how the admission process works will determine the type of data analysis you will carry out.</p>
</section>
<section id="the-why-in-aml" class="level1">
<h1>The Why in AML</h1>
<p>In Anti Money Laundering (AML),the Five W’s and 1 H are fundamental to investigating and reporting suspicious behavior.</p>
<ol type="1">
<li><strong>Who</strong> is conducting the suspicious activity?</li>
<li><strong>What</strong> instruments or mechanisms are being used to facilitate the suspected transactions ?</li>
<li><strong>When</strong> did the suspicious activity occur?</li>
<li><strong>Where</strong> did the suspicious activity take place?</li>
<li><strong>Why</strong> is the activity suspicious?</li>
<li><strong>How</strong> did the suspicious activity occur?</li>
</ol>
<p>The first four questions (Who, What, When and Where) are straightforward to answer. They entail only a description of some entity and activity . The last two (Why and How) are more interesting.</p>
<section id="why-is-an-episode-of-transactional-activity-suspicious" class="level2">
<h2 class="anchored" data-anchor-id="why-is-an-episode-of-transactional-activity-suspicious">Why is an episode of transactional activity suspicious ?</h2>
<p>As the <a href="https://www.fincen.gov/sites/default/files/shared/sarnarrcompletguidfinal_112003.pdf">Fincen guidance</a> lays out, an episode is suspicious if it conforms to some pattern of suspicious activity or red flag, such as:</p>
<blockquote class="blockquote">
<p>Unusually complex series of transactions indicative of layering activity involving multiple accounts, banks, parties, jurisdictions;</p>
</blockquote>
<p>An episode of activity is suspicious because it is consistent with a red flag. This is the answer to “Why?”</p>
<p>“How” describes how the episode of activity fits into the aforementioned pattern.</p>
<p>In other words, the “Why” is the <strong>cause</strong> of suspicion. As per the counterfactual definition of causality,this also means that if the transactions did not fit in with the pattern, there would be no reason to consider the transaction suspicious. We are interested in identifying “necessary” causation. Typically, none of these red flags or patterns in isolation guarantees the activity in question is suspicious; it is not a sufficient cause.</p>
<p>This suggests a very scientific approach to investigations.</p>
<p>Every alert or case begins with a null hypothesis (H0) and an alternate hypothesis (H1)</p>
<p>H0: The entity did not carry out transactions consistent with a pattern of interest. <br> H1: The entity carried out transactions with the pattern of interest.</p>
<p>An investigator is trying to collect evidence to reject the null hypothesis. If sufficient evidence; which is determined by the risk tolerance of the institution; is available, then a SAR has to be filed outlining the “Why” and the “How”—the hypothesis tested and the evidence gathered.</p>
</section>
<section id="transaction-monitoring-systems-need-to-evolve" class="level2">
<h2 class="anchored" data-anchor-id="transaction-monitoring-systems-need-to-evolve">Transaction Monitoring Systems need to evolve</h2>
<p>Today, transaction monitoring systems generate a case(a collection of alerts) and leave investigators to come up with their own hypotheses. This is equivalent to presenting the results of an experiment without stating the hypothesis or theory being tested.</p>
<p>To make investigators productive, transaction monitoring systems should evolve from just presenting a collection of alerts to also presenting the hypothesis being evaluated.</p>
<p>A hypothesis is an explanation for potentially nefarious activity - a red flag. A good hypothesis or explanations should adhere to at least the first two criteria laid out by Deutch.</p>
<ol type="1">
<li>It should be hard to vary</li>
<li>It should be falsifiable</li>
</ol>
<p>The more specific a pattern or red flag is, the harder it is to vary. For example, “the behavior of the entity changed” is a poor explanation for suspicious activity. A change in behavior could also be because someone sold their car or their house.</p>
<p>A potentially good explanation for suspicious activity is:</p>
<blockquote class="blockquote">
<p>Transactions that are not commensurate with the stated business type and/or that are unusual and unexpected in comparison with the volumes of similar businesses operating in the same locale.</p>
</blockquote>
<p>Given the hypothesis is specific, it is also eminently falsifiable.</p>
<p>In summary, a good transaction monitoring system doesn’t just generate a case or collection of alerts, it will also suggest good hypotheses that explains why the entity in question is suspicious.</p>
</section>
</section>
<section id="the-problem-with-aml-detection-models" class="level1">
<h1>The Problem with AML Detection Models</h1>
<p>This brings us to a dichotomy in the objectives of AML models. We want AML models to have high predictive power so that AML programs are efficient and effective. However, the key expected output of AML Transaction Monitoring is a well constructed SAR which answers the Who, What , Where, When, How and most importantly the <strong>Why</strong>.</p>
<p>However, a key lesson of causal analysis is that a good predictive model need not be good causal model.</p>
<blockquote class="blockquote">
<p>When we design a statisitcal model, we must decide where we want to understand causes or just predict.These are not the same goal and different models are needed for each - Richard Mclreath</p>
</blockquote>
<p>This problem is particularly acute in the presence of <strong>colliders</strong>. Consider a dataset comprising Age,a binary flag indicating marital status and a metric for happiness. This simulated dataset is available as part of the <code>rethinking</code> package and has been generated in line with the causal relationship visualized below - a collider.The arrows from Happiness(H) and Age(A) collide at marriage(M).</p>
<p>This suggests that individuals who are generally happy and reach a marriageable age get married.</p>
<div class="figure">
<p><img src="./images/dag3.png" alt=" Causal Diagram of Marriage"></p>
<p class="caption">
</p><p>Figure 3: Causal Diagram of Marriage</p>
<p></p>
</div>
<p>As a happiness researcher who gets access to this data we might be interested in identifying the causes or predictors of happiness.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Simulate data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span>  <span class="fu">sim_happiness</span>(<span class="at">seed=</span><span class="dv">1</span>, <span class="at">N_years=</span><span class="dv">1000</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Review summary of the data</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>##                    mean         sd      5.5%     94.5%     histogram
## age        3.300000e+01 18.7688832  4.000000 62.000000 ▇▇▇▇▇▇▇▇▇▇▇▇▇
## married    2.838462e-01  0.4510366  0.000000  1.000000    ▇▁▁▁▁▁▁▁▁▂
## happiness -1.000070e-16  1.2144211 -1.789474  1.789474      ▇▅▇▅▅▇▅▇</code></pre>
<p>Given we deal with classification problems in financial crime, I will engineer a binary happiness flag with the goal of predicting happiness.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>happiness_flag <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(d<span class="sc">$</span>happiness<span class="sc">&lt;</span><span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>married <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(d<span class="sc">$</span>married)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can partition the data into a train and validation dataset.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get number of records</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(d)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Split into train and test sets</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>N,<span class="fl">0.8</span><span class="sc">*</span>N,<span class="at">replace=</span><span class="cn">FALSE</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>d_train <span class="ot">&lt;-</span> d[train_index,]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>d_valid <span class="ot">&lt;-</span> d[<span class="sc">-</span>train_index,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can consider three predictive models given this data.</p>
<p>First, we can train a model using just Age.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>glm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>( happiness_flag <span class="sc">~</span> age,<span class="at">data=</span>d_train, <span class="at">family =</span> <span class="st">"binomial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Second, we can train a model using just marital status.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>glm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>( happiness_flag <span class="sc">~</span> married,<span class="at">data=</span>d_train, <span class="at">family =</span> <span class="st">"binomial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Third, we can train a model considering both Age and marital status.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>glm3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(happiness_flag<span class="sc">~</span> age <span class="sc">+</span> married,<span class="at">data=</span>d_train, <span class="at">family =</span> <span class="st">"binomial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can evaluate all three models on the validation set and pick the best performing model.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get predicted probabilities</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>valid_preds1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm1,d_valid, <span class="at">type =</span> <span class="st">"response"</span>) </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>valid_preds2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm2,d_valid, <span class="at">type =</span> <span class="st">"response"</span>) </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>valid_preds3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm3,d_valid, <span class="at">type =</span> <span class="st">"response"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Below we calculate the Area under the ROC curve for each of the three models.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>roc1 <span class="ot">&lt;-</span> <span class="fu">roc</span>(d_valid<span class="sc">$</span>happiness_flag,valid_preds1)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>roc2 <span class="ot">&lt;-</span> <span class="fu">roc</span>(d_valid<span class="sc">$</span>happiness_flag,valid_preds2)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>roc3 <span class="ot">&lt;-</span> <span class="fu">roc</span>(d_valid<span class="sc">$</span>happiness_flag,valid_preds3)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"For Model 1, Area under the curve:"</span>, <span class="fu">round</span>(roc1<span class="sc">$</span>auc,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] "For Model 1, Area under the curve:0.51"</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"For Model 2,  Area under the curve:"</span>,<span class="fu">round</span>(roc2<span class="sc">$</span>auc,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] "For Model 2,  Area under the curve:0.68"</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"For Model 3,  Area under the curve:"</span>,<span class="fu">round</span>(roc3<span class="sc">$</span>auc,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## [1] "For Model 3,  Area under the curve:0.74"</code></pre>
<p>Quite clearly, the third model is the best predictive model and would be selected if prediction accuracy is our goal.</p>
<p>However, let’s analyze this model.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Call:
## glm(formula = happiness_flag ~ age + married, family = "binomial", 
##     data = d_train)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  0.23883    0.13381   1.785   0.0743 .  
## age         -0.02786    0.00426  -6.540 6.17e-11 ***
## married1     2.45988    0.19361  12.705  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1441.6  on 1039  degrees of freedom
## Residual deviance: 1238.8  on 1037  degrees of freedom
## AIC: 1244.8
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>The estimates suggest that age and marital status are both statistically significant when predicting happiness.</p>
<p><strong>If this were a model to predict financial crime, we would highlight both these variables as interesting to an investigator, which is misleading given the underlying data..</strong></p>
<p>Instead, let’s look more closely at the first model</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>## 
## Call:
## glm(formula = happiness_flag ~ age, family = "binomial", data = d_train)
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept) -0.0079798  0.1267758  -0.063    0.950
## age         -0.0004523  0.0033126  -0.137    0.891
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1441.6  on 1039  degrees of freedom
## Residual deviance: 1441.6  on 1038  degrees of freedom
## AIC: 1445.6
## 
## Number of Fisher Scoring iterations: 3</code></pre>
<p>We see that age is not a significant predictor of happiness.</p>
<p>When we include marital status in the model, age becomes statistically significant due to collider bias. Conditioning on a collider can end up inducing spurious relationships between variables being modeled.</p>
<p>The key lesson is high performing ML models might be good predictors of financial crime but they might mislead investigators who are trying to answer the “Why?” of financial crime. ML models are inductive and are not informed by theory. They do not care about cause, only association. Hence predictions of ML models or post-hoc explanations of these models will not have causal logic</p>
</section>
<section id="bridging-this-gap" class="level1">
<h1>Bridging This Gap</h1>
<p>We do not want to give up on using the best performing predictive models, whether they are rule-based scenarios or neural nets. How do we meet these competing objectives of AML Detection—good predictive performance and reliable causal explanations?</p>
<p>In this <a href="https://arxiv.org/abs/2109.09904">paper</a>, Kambhampati et al proposes an architecture of an AI system that exposes a symbolic interface to a human user.</p>
<div class="figure">
<p><img src="./images/human_ai_interface.png" alt=" Overall architecture of an AI system exposing a symboic interface to a human user"></p>
<p class="caption">
</p><p>Figure 4: Overall architecture of an AI system exposing a symboic interface to a human user</p>
<p></p>
</div>
<p>This symbolic interface should operate using symbols that have meaning to the human in the loop - a compliance officer or an investigator in the case of AML. The symbolic interface enables the AI system to provide explanations (hopefully causal) of its decisions to humans (investigators) while accepting guidance/preferences from humans(investigators and compliance officers) in the form of advice or feedback.</p>
<p>Further, this symbolic interface should allow representation of causal relations.</p>
</section>
<section id="theory-of-transaction-monitoring" class="level1">
<h1>Theory of Transaction Monitoring</h1>
<p>A Transaction Monitoring System is essentially a manifestation of a Financial Institution’s “Theory of Financial Crime” . They require an FI to come up with two key hypotheses:</p>
<ol type="1">
<li>What are my FI’s risks - what are the risk factors and red flags that are of interest ?</li>
<li>How best to mitigate them - What rules and models should be used to mitigate these risks ?</li>
</ol>
<p>To make AML compliance scientific, we need to follow through with the next three steps of the scientific method.</p>
<ul>
<li>Deduce testable consequences of the hypothesis - If the scenarios or models alert, is the focal entity suspicious and worthy of a SAR ?</li>
<li>Perform an experiment and collect evidence - Generate cases and get human feedback on the case</li>
<li>Update your belief in the hypothesis - Use the feedback to update the two key hypotheses.</li>
</ul>
<p>I propose a modified version of the symbolic Human - AI interface as illustrated below.</p>
<div class="figure">
<p><img src="./images/ToFC.png" alt=" Symbolic Human Interface for a TMS"></p>
<p class="caption">
</p><p>Figure 5: Symbolic Human Interface for a TMS</p>
<p></p>
</div>
<p>In this system,</p>
<ol type="1">
<li>The compliance officer lays out her hypotheses which is explicitly captured in a Symbolic- Causal model that represents an institution’s Theory of Financial Crime.The relationship between the various components of the TMS is explicitly captured by the causal model <br></li>
<li>The Data Scientist or Modeler constructs the TMS (Transaction Monitoring System) to align with this causal model. <br></li>
<li>The TMS generates alerts <br></li>
<li>The Symbolic Causal model consumes the alerts and generates cases along with causal Explanations. <br></li>
<li>Investigators review the cases and provide feedback (labels) <br></li>
<li>The causal model is revised using these labels.<br></li>
<li>The Compliance officer approves these revisions or comes up with new hypotheses that are captured explicitly in the model.<br></li>
<li>The TMS is modified to re-align with the institution’s revised “Theory of Financial Crime”. <br></li>
</ol>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>I have laid out two key limitations with the current approach to building and maintaining Transaction Monitoring Systems</p>
<ul>
<li>They are ill-equipped to help investigators answer the “Why?” of AML and create meaningful SARs</li>
<li>They do not facilitate the application of the scientific method to AML. When we do not approach the problem using the scientific method, is it any surprise that Transaction Monitoring Systems have shown little improvement over the last decade ?</li>
</ul>
<p>In the next blog post, I will share a more prescriptive approach on creating a symbolic-causal model and how it can be systematically updated based on incoming labels.</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ol type="1">
<li>The Book of Why: The New Science of Cause and Effect - By Judea Pearl and Dana Mackenzie <br></li>
<li>Statistical Rethinking: A Bayesian Course with Examples in R and Stan - By Richard McElreath <br></li>
<li>The Beginning of Infinity - By David Deutch <br></li>
<li>https://arxiv.org/abs/2109.09904</li>
<li>https://www.fincen.gov/sites/default/files/shared/sarnarrcompletguidfinal_112003.pdf</li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Govind G Nair</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>